!function(){"use strict";angular.module("app",["app.directives","shared.components","ui.bootstrap","smart-table"])}();
!function(){angular.module("app.directives",[])}();
!function(){var e=angular.module("app.directives");e.directive("stSubmitSearch",["stConfig","$timeout","$parse",function(e,t,r){return{require:"^stTable",link:function(e,t,r,n){return t.bind("click",function(){var e=n;e.pipe()})}}}]),e.directive("clearKey",function(){return{restrict:"EA",require:"ngModel",link:function(e,t,r,n){t.on("keydown",function(t){27===t.which&&(n.$setViewValue(null),n.$render(),e.$apply())})}}}),e.directive("stResetSearch",function(){return{restrict:"EA",require:["^stTable","^ngModel"],link:function(e,t,r,n){return t.bind("click",function(){var t=n[1],r=n[0];return e.$apply(function(){angular.forEach(t.$viewValue,function(e,r){"page"===r.toLowerCase()&&(t.$viewValue[r]=1),Array.isArray(e)||_.includes(r.toLowerCase(),"page")||(t.$viewValue[r]=null)});var e=r.tableState();return e.search.predicateObject={},e.pagination.start=0,r.pipe()})})}}}),e.directive("stClearKey",function(){return{restrict:"EA",require:["^stTable","^ngModel"],link:function(e,t,r,n){t.on("keydown",function(r){var i=n[1],a=n[0];return 13===r.which?a.pipe():27===r.which?void 0!==t.context.attributes["st-search"]?e.$apply(function(){var e=t.context.attributes["st-search"].value,r=a.tableState();return r.search.predicateObject[e]="",a.pipe()}):e.$apply(function(){i.$setViewValue(null),i.$render()}):void 0})}}})}();
!function(){angular.module("shared.components",[])}();
!function(){function n(n,o){var e=this;e.$onInit=function(){n.get("api/publisher").then(function(n){e.publishers=n.data}).catch(function(n){console.log(n.message)})},e.create=function(){o.open({component:"publisherEdit",bindings:{modalInstance:"<"},size:"lg"}).result.then(function(n){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),console.info("returning result",n),e.publishers.unshift(n),e.id=n.id},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})},e.edit=function(){o.open({component:"publisherEdit",bindings:{modalInstance:"<"},resolve:{id:e.id},size:"lg"}).result.then(function(n){angular.forEach(e.publishers,function(o){o.id===e.id&&(angular.extend(o,n),e.id=o.id)})},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})}}var o=angular.module("shared.components");o.component("publisherSelect",{bindings:{id:"="},templateUrl:"app/common/publisher-select.component.html",controller:["$http","$uibModal",n]})}();
!function(){"use strict";function t(t){function n(n){return t.get("api/product/"+n).then(function(t){return t.data}).catch(function(t){console.log(t.message)})}function e(n){return t.get("api/product",{params:n}).then(function(t){return t.data}).catch(function(t){console.log(t.message)})}function u(n){return t.delete("api/product/"+n).then(function(t){return t.data}).catch(function(t){console.log(t.message)})}function c(n){return n.id?t.put("api/product",n).then(function(t){return t.data}).catch(function(t){return t.message}):t.post("api/product",n).then(function(t){return t.data}).catch(function(t){return t.message})}return{getProduct:n,getAllProducts:e,remove:u,save:c}}var n=angular.module("app");n.factory("Product",["$http",t])}();
!function(){function t(t){var n=this;n.$onInit=function(){n.title="New Product",n.resolve&&(n.id=n.resolve.id),n.id&&t.getProduct(n.id).then(function(t){n.product=t,n.title=t.title})},n.cancel=function(){n.dismiss()},n.save=function(){return t.save(n.product).then(function(t){angular.extend(n.product,t)}).catch(function(t){console.log("Error saving product",t.message)}).finally(function(){n.modalInstance.close(n.product)})}}var n=angular.module("app");n.component("productEdit",{templateUrl:"app/product/product-edit.component.html",bindings:{id:"<",resolve:"<",close:"&",dismiss:"&",modalInstance:"<"},controller:["Product",t]})}();
!function(){"use strict";function o(o,n){var e,t=this,s=10;t.searchModel={page:1,pageSize:s},t.$onInit=function(){console.log("product list init"),t.title="Product List"},t.search=function(o){e=o,console.log("search"),n.getAllProducts(t.searchModel).then(function(o){t.products=o.results,t.searchModel=o,delete t.searchModel.results})},t.paged=function(){t.search(e)},t.create=function(){o.open({component:"productEdit",bindings:{modalInstance:"<"},size:"md"}).result.then(function(o){t.products.unshift(o)},function(o){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+o)})},t.edit=function(n){o.open({component:"productEdit",bindings:{modalInstance:"<"},resolve:{id:n.id},size:"md"}).result.then(function(o){angular.extend(n,o)},function(o){})},t.delete=function(o){console.log("delete",o),n.remove(o.id).then(function(n){var e=t.products.indexOf(o);t.products.splice(e,1)})},t.showDetails=function(n){o.open({component:"productSummary",bindings:{modalInstance:"<"},resolve:{id:n,asModal:!0},size:"md"}).result.then(function(o){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),console.info(o)},function(o){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+o)})}}var n=angular.module("app");n.component("productList",{templateUrl:"app/product/product-list.component.html",controller:["$uibModal","Product",o]})}();
!function(){function o(o){var t=this;t.$onInit=function(){t.resolve&&(t.id=t.resolve.id,t.asModal=t.resolve.asModal,t.addStaffVisible=!1),o.getProduct(t.id).then(function(o){t.product=o})},t.createStaff=function(){console.log("add staff modal")},t.cancel=function(){t.dismiss()}}var t=angular.module("app");t.component("productSummary",{bindings:{id:"<",asModal:"<",resolve:"<",close:"&",dismiss:"&"},templateUrl:"app/product/product-summary.component.html",controller:["Product",o]})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJkaXJlY3RpdmVzL2RpcmVjdGl2ZXMubW9kdWxlcy5qcyIsImRpcmVjdGl2ZXMvc3RUYWJsZS5kaXJlY3RpdmUuanMiLCJjb21tb24vY29tcG9uZW50cy5tb2R1bGUuanMiLCJjb21tb24vcHVibGlzaGVyLXNlbGVjdC5jb21wb25lbnQuanMiLCJzZXJ2aWNlcy9wcm9kdWN0LnNlcnZpY2UuanMiLCJwcm9kdWN0L3Byb2R1Y3QtZWRpdC5jb21wb25lbnQuanMiLCJwcm9kdWN0L3Byb2R1Y3QtbGlzdC5jb21wb25lbnQuanMiLCJwcm9kdWN0L3Byb2R1Y3Qtc3VtbWFyeS5jb21wb25lbnQuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImRpcmVjdGl2ZSIsInN0Q29uZmlnIiwiJHRpbWVvdXQiLCIkcGFyc2UiLCJyZXF1aXJlIiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHIiLCJjdHJsIiwiYmluZCIsInRhYmxlQ3RybCIsInBpcGUiLCJyZXN0cmljdCIsImVsIiwiYXR0cnMiLCJvbiIsImV2ZW50Iiwid2hpY2giLCIkc2V0Vmlld1ZhbHVlIiwiJHJlbmRlciIsIiRhcHBseSIsImN0cmxzIiwibW9kZWwiLCJmb3JFYWNoIiwiJHZpZXdWYWx1ZSIsInZhbHVlIiwia2V5IiwidG9Mb3dlckNhc2UiLCJBcnJheSIsImlzQXJyYXkiLCJfIiwiaW5jbHVkZXMiLCJ0YWJsZVN0YXRlIiwic2VhcmNoIiwicHJlZGljYXRlT2JqZWN0IiwicGFnaW5hdGlvbiIsInN0YXJ0IiwibmdNb2RlbCIsInVuZGVmaW5lZCIsImNvbnRleHQiLCJhdHRyaWJ1dGVzIiwiZmllbGROYW1lIiwiY29udHJvbGxlciIsIiRodHRwIiwiJHVpYk1vZGFsIiwiJGN0cmwiLCJ0aGlzIiwiJG9uSW5pdCIsImdldCIsInRoZW4iLCJyIiwicHVibGlzaGVycyIsImRhdGEiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJtZXNzYWdlIiwiY3JlYXRlIiwib3BlbiIsImNvbXBvbmVudCIsImJpbmRpbmdzIiwibW9kYWxJbnN0YW5jZSIsInNpemUiLCJyZXN1bHQiLCJpbmZvIiwidW5zaGlmdCIsImlkIiwicmVhc29uIiwiZWRpdCIsInJlc29sdmUiLCJpdGVtIiwiZXh0ZW5kIiwidGVtcGxhdGVVcmwiLCJzZXJ2aWNlQ29udHJvbGxlciIsImdldFByb2R1Y3QiLCJnZXRBbGxQcm9kdWN0cyIsInNlYXJjaE1vZGVsIiwicGFyYW1zIiwicmVtb3ZlIiwiZGVsZXRlIiwic2F2ZSIsInByb2R1Y3QiLCJwdXQiLCJwb3N0IiwiZmFjdG9yeSIsInNlcnZpY2UiLCJ0aXRsZSIsImNhbmNlbCIsImRpc21pc3MiLCJmaW5hbGx5IiwiY2xvc2UiLCIkbW9kYWwiLCJ0YWJsZVN0YXRlUmVmIiwicGFnZVNpemVEZWZhdWx0IiwicGFnZSIsInBhZ2VTaXplIiwicHJvZHVjdHMiLCJyZXN1bHRzIiwicGFnZWQiLCJpZHgiLCJpbmRleE9mIiwic3BsaWNlIiwic2hvd0RldGFpbHMiLCJhc01vZGFsIiwiYWRkU3RhZmZWaXNpYmxlIiwiY3JlYXRlU3RhZmYiXSwibWFwcGluZ3MiOiJDQUNBLFdBQ0ksWUFFYUEsU0FBUUMsT0FBTyxPQUN4QixpQkFDQSxvQkFDQSxlQUNBO0NDUFIsV0FDSUQsUUFBUUMsT0FBTztDQ0RuQixXQUVJLEdBQUlBLEdBQVNELFFBQVFDLE9BQU8saUJBRTVCQSxHQUFPQyxVQUFVLGtCQUFtQixXQUFZLFdBQVksU0FBVSxTQUFVQyxFQUFVQyxFQUFVQyxHQUNoRyxPQUNJQyxRQUFTLFdBQ1RDLEtBQU0sU0FBVUMsRUFBT0MsRUFBU0MsRUFBTUMsR0FDbEMsTUFBT0YsR0FBUUcsS0FBSyxRQUNoQixXQUNJLEdBQUlDLEdBQVlGLENBQ2hCRSxHQUFVQyxjQU85QmIsRUFBT0MsVUFBVSxXQUFZLFdBQ3pCLE9BQ0lhLFNBQVUsS0FDVlQsUUFBUyxVQUNUQyxLQUFNLFNBQVVDLEVBQU9RLEVBQUlDLEVBQU9OLEdBQzlCSyxFQUFHRSxHQUFHLFVB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c0IsSUFBSWxCLEtBQUssU0FBVUMsR0FDeENMLEVBQU1xQyxRQUFVaEMsS0FJeEJMLEVBQU02RCxZQUFjLFdBQ2hCbkQsUUFBUUMsSUFBSSxvQkFHaEJYLEVBQU0yQyxPQUFTLFdBQ1gzQyxFQUFNNEMsV0F0QmQsR0FBSTNGLEdBQVNELFFBQVFDLE9BQU8sTUEwQjVCQSxHQUFPOEQsVUFBVSxrQkFFYkMsVUFDSU0sR0FBSSxJQUNKcUMsUUFBUyxJQUNUbEMsUUFBUyxJQUNUcUIsTUFBTyxJQUNQRixRQUFTLEtBRWJoQixZQUFhLDZDQUNiL0IsWUFBYSxVQUFXQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9hcHAubW9kdWxlLmpzXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFtcclxuICAgICAgICAnYXBwLmRpcmVjdGl2ZXMnLFxyXG4gICAgICAgICdzaGFyZWQuY29tcG9uZW50cycsXHJcbiAgICAgICAgJ3VpLmJvb3RzdHJhcCcsIFxyXG4gICAgICAgICdzbWFydC10YWJsZSdcclxuICAgIF0pO1xyXG5cclxuXHJcbn0pKCk7IiwiLy9kaXJlY3RpdmVzLm1vZHVsZXMuanNcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJywgW10pOyBcclxufSkoKTsiLCIvL3N0VGFibGUuZGlyZWN0aXZlLmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycpO1xyXG5cclxuICAgIG1vZHVsZS5kaXJlY3RpdmUoJ3N0U3VibWl0U2VhcmNoJywgWydzdENvbmZpZycsICckdGltZW91dCcsICckcGFyc2UnLCBmdW5jdGlvbiAoc3RDb25maWcsICR0aW1lb3V0LCAkcGFyc2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1aXJlOiAnXnN0VGFibGUnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHIsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmJpbmQoJ2NsaWNrJyxcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZUN0cmwgPSBjdHJsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XHJcblxyXG4gICAgbW9kdWxlLmRpcmVjdGl2ZShcImNsZWFyS2V5XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsLCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgZWwub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggIT09IDI3KSB7IHJldHVybjsgfSAvLyBjaGVjayBrZXkgaG93IHlvdSB3YW50XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0Vmlld1ZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJHJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG5cclxuICAgIG1vZHVsZS5kaXJlY3RpdmUoXCJzdFJlc2V0U2VhcmNoXCIsXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZTogWydec3RUYWJsZScsICdebmdNb2RlbCddLFxyXG4gICAgICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmxzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmJpbmQoJ2NsaWNrJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSBjdHJsc1sxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IGN0cmxzWzBdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKG1vZGVsLiR2aWV3VmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkudG9Mb3dlckNhc2UoKSA9PT0gJ3BhZ2UnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLiR2aWV3VmFsdWVba2V5XSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSB8fCBfLmluY2x1ZGVzKGtleS50b0xvd2VyQ2FzZSgpLCAncGFnZScpKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuJHZpZXdWYWx1ZVtrZXldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVTdGF0ZSA9IGN0cmwudGFibGVTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVTdGF0ZS5wYWdpbmF0aW9uLnN0YXJ0ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgbW9kdWxlLmRpcmVjdGl2ZShcInN0Q2xlYXJLZXlcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgICAgICAgICByZXF1aXJlOiBbJ15zdFRhYmxlJywgJ15uZ01vZGVsJ10sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmxzKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5nTW9kZWwgPSBjdHJsc1sxXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IGN0cmxzWzBdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdHJsLnBpcGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSAyNykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuY29udGV4dC5hdHRyaWJ1dGVzWydzdC1zZWFyY2gnXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGROYW1lID0gZWxlbWVudC5jb250ZXh0LmF0dHJpYnV0ZXNbJ3N0LXNlYXJjaCddLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZVN0YXRlID0gY3RybC50YWJsZVN0YXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0W2ZpZWxkTmFtZV0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3RybC5waXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kcmVuZGVyKCk7IC8vIHdpbGwgdXBkYXRlIHRoZSBpbnB1dCB2YWx1ZSBhcyB3ZWxsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuXHJcbn1cclxuKSgpOyIsIi8vc2hhcmVkLWNvbXBvbmVudHMubW9kdWxlLmpzXHJcbihmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ3NoYXJlZC5jb21wb25lbnRzJywgW10pO1xyXG4gICAgfVxyXG4pKCk7IiwiLy9wdWJsaXNoZXItbGlzdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ3NoYXJlZC5jb21wb25lbnRzJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCwgJHVpYk1vZGFsKSB7XHJcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCdhcGkvcHVibGlzaGVyJykudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwucHVibGlzaGVycyA9IHIuZGF0YTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAncHVibGlzaGVyRWRpdCcsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ2xnJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBjbG9zZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVzdWx0IHdhcy0+XCIpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCdyZXR1cm5pbmcgcmVzdWx0JywgcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICRjdHJsLnB1Ymxpc2hlcnMudW5zaGlmdChyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuaWQgPSByZXN1bHQuaWQ7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGRpbWlzc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlYXNvbiB3YXMtPlwiICsgcmVhc29uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5lZGl0ID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAncHVibGlzaGVyRWRpdCcsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAkY3RybC5pZFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdsZydcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKCRjdHJsLnB1Ymxpc2hlcnMsIGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaWQgPT09ICRjdHJsLmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGl0ZW0sIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRjdHJsLmlkID0gaXRlbS5pZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGRpbWlzc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlYXNvbiB3YXMtPlwiICsgcmVhc29uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ3B1Ymxpc2hlclNlbGVjdCcsXHJcbiAgICB7XHJcbiAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgaWQ6ICc9J1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvY29tbW9uL3B1Ymxpc2hlci1zZWxlY3QuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAnJHVpYk1vZGFsJywgY29udHJvbGxlcl1cclxuICAgIH0pO1xyXG5cclxuXHJcbn1cclxuKSgpOyIsIi8vcHJvZHVjdC5zZXJ2aWNlLmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpOyBcclxuICAgIFxyXG4gICAgbW9kdWxlLmZhY3RvcnkoJ1Byb2R1Y3QnLCBbJyRodHRwJywgc2VydmljZUNvbnRyb2xsZXJdKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcigkaHR0cCkge1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRQcm9kdWN0OiBnZXRQcm9kdWN0LFxyXG4gICAgICAgICAgICBnZXRBbGxQcm9kdWN0czogZ2V0QWxsUHJvZHVjdHMsXHJcbiAgICAgICAgICAgIHJlbW92ZTogcmVtb3ZlLCBcclxuICAgICAgICAgICAgc2F2ZTogc2F2ZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFByb2R1Y3QoaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnYXBpL3Byb2R1Y3QvJyArIGlkKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gci5kYXRhO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QWxsUHJvZHVjdHMoc2VhcmNoTW9kZWwpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnYXBpL3Byb2R1Y3QnLCB7IHBhcmFtczogc2VhcmNoTW9kZWwgfSkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHIuZGF0YTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZShpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKCdhcGkvcHJvZHVjdC8nICsgaWQpLnRoZW4oZnVuY3Rpb24ocikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHIuZGF0YTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pOyBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNhdmUocHJvZHVjdCkge1xyXG4gICAgICAgICAgICBpZiAocHJvZHVjdC5pZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCgnYXBpL3Byb2R1Y3QnLCBwcm9kdWN0KS50aGVuKGZ1bmN0aW9uKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gci5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVyci5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnYXBpL3Byb2R1Y3QnLCBwcm9kdWN0KS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG59XHJcbikoKTsiLCIvL3Byb2R1Y3QtZWRpdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcihzZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGN0cmwudGl0bGUgPSAnTmV3IFByb2R1Y3QnOyBcclxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlkID0gJGN0cmwucmVzb2x2ZS5pZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoJGN0cmwuaWQpIHtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2UuZ2V0UHJvZHVjdCgkY3RybC5pZCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgICRjdHJsLnByb2R1Y3QgPSByO1xyXG4gICAgICAgICAgICAgICAgICAgICRjdHJsLnRpdGxlID0gci50aXRsZTsgXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGN0cmwuZGlzbWlzcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuc2F2ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlcnZpY2Uuc2F2ZSgkY3RybC5wcm9kdWN0KS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCgkY3RybC5wcm9kdWN0LCByKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIHNhdmluZyBwcm9kdWN0JywgZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLm1vZGFsSW5zdGFuY2UuY2xvc2UoJGN0cmwucHJvZHVjdCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgncHJvZHVjdEVkaXQnLFxyXG4gICAge1xyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL3Byb2R1Y3QvcHJvZHVjdC1lZGl0LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICBpZDogJzwnLFxyXG4gICAgICAgICAgICByZXNvbHZlOiAnPCcsXHJcbiAgICAgICAgICAgIGNsb3NlOiAnJicsXHJcbiAgICAgICAgICAgIGRpc21pc3M6ICcmJyxcclxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogJzwnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb250cm9sbGVyOiBbJ1Byb2R1Y3QnLCBjb250cm9sbGVyXVxyXG4gICAgfSk7XHJcbn0pKCk7XHJcbiAgICAiLCIvL3Byb2R1Y3QtbGlzdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJG1vZGFsLCBwcm9kdWN0KSB7XHJcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcclxuICAgICAgICB2YXIgcGFnZVNpemVEZWZhdWx0ID0gMTA7XHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcblxyXG4gICAgICAgICRjdHJsLnNlYXJjaE1vZGVsID0ge1xyXG4gICAgICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgICAgICBwYWdlU2l6ZTogcGFnZVNpemVEZWZhdWx0XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3Byb2R1Y3QgbGlzdCBpbml0Jyk7XHJcbiAgICAgICAgICAgICRjdHJsLnRpdGxlID0gJ1Byb2R1Y3QgTGlzdCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5zZWFyY2ggPSBmdW5jdGlvbiAodGFibGVTdGF0ZSkge1xyXG4gICAgICAgICAgICB0YWJsZVN0YXRlUmVmID0gdGFibGVTdGF0ZTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlYXJjaCcpO1xyXG4gICAgICAgICAgICBwcm9kdWN0LmdldEFsbFByb2R1Y3RzKCRjdHJsLnNlYXJjaE1vZGVsKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5wcm9kdWN0cyA9IHIucmVzdWx0cztcclxuICAgICAgICAgICAgICAgICRjdHJsLnNlYXJjaE1vZGVsID0gcjtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSAkY3RybC5zZWFyY2hNb2RlbC5yZXN1bHRzO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnBhZ2VkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC5zZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ3Byb2R1Y3RFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnByb2R1Y3RzLnVuc2hpZnQocmVzdWx0KTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgZGltaXNzZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVhc29uIHdhcy0+XCIgKyByZWFzb24pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmVkaXQgPSBmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ3Byb2R1Y3RFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGl0ZW0uaWRcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGl0ZW0sIHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5kZWxldGUgPSBmdW5jdGlvbiAoaXRlbSkge1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2RlbGV0ZScsIGl0ZW0pO1xyXG4gICAgICAgICAgICBwcm9kdWN0LnJlbW92ZShpdGVtLmlkKS50aGVuKGZ1bmN0aW9uKHIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpZHggPSAkY3RybC5wcm9kdWN0cy5pbmRleE9mKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwucHJvZHVjdHMuc3BsaWNlKGlkeCwgMSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gICBcclxuICAgICAgICBcclxuICAgICAgICAkY3RybC5zaG93RGV0YWlscyA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdwcm9kdWN0U3VtbWFyeScsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcclxuICAgICAgICAgICAgICAgICAgICBhc01vZGFsOiB0cnVlXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ21kJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBjbG9zZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVzdWx0IHdhcy0+XCIpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGRpbWlzc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlYXNvbiB3YXMtPlwiICsgcmVhc29uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ3Byb2R1Y3RMaXN0JyxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL3Byb2R1Y3QvcHJvZHVjdC1saXN0LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogWyckdWliTW9kYWwnLCAnUHJvZHVjdCcsIGNvbnRyb2xsZXJdXHJcbiAgICAgICAgfSk7XHJcblxyXG59XHJcbikoKTsiLCIvL3Byb2R1Y3Qtc3VtbWFyeS5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcihzZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlkID0gJGN0cmwucmVzb2x2ZS5pZDtcclxuICAgICAgICAgICAgICAgICRjdHJsLmFzTW9kYWwgPSAkY3RybC5yZXNvbHZlLmFzTW9kYWw7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5hZGRTdGFmZlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2VydmljZS5nZXRQcm9kdWN0KCRjdHJsLmlkKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5wcm9kdWN0ID0gcjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jcmVhdGVTdGFmZiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnYWRkIHN0YWZmIG1vZGFsJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ3Byb2R1Y3RTdW1tYXJ5JyxcclxuICAgIHtcclxuICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICBpZDogJzwnLFxyXG4gICAgICAgICAgICBhc01vZGFsOiAnPCcsXHJcbiAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcclxuICAgICAgICAgICAgY2xvc2U6ICcmJyxcclxuICAgICAgICAgICAgZGlzbWlzczogJyYnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9wcm9kdWN0L3Byb2R1Y3Qtc3VtbWFyeS5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogWydQcm9kdWN0JywgY29udHJvbGxlcl1cclxuICAgIH0pO1xyXG5cclxufVxyXG4pKCk7Il19
