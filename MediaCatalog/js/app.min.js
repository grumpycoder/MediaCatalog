!function(){"use strict";angular.module("app",["app.directives","shared.components","ui.bootstrap","smart-table"])}();
!function(){angular.module("app.directives",[])}();
!function(){var e=angular.module("app.directives");e.directive("stSubmitSearch",["stConfig","$timeout","$parse",function(e,t,r){return{require:"^stTable",link:function(e,t,r,n){return t.bind("click",function(){var e=n;e.pipe()})}}}]),e.directive("clearKey",function(){return{restrict:"EA",require:"ngModel",link:function(e,t,r,n){t.on("keydown",function(t){27===t.which&&(n.$setViewValue(null),n.$render(),e.$apply())})}}}),e.directive("stResetSearch",function(){return{restrict:"EA",require:["^stTable","^ngModel"],link:function(e,t,r,n){return t.bind("click",function(){var t=n[1],r=n[0];return e.$apply(function(){angular.forEach(t.$viewValue,function(e,r){"page"===r.toLowerCase()&&(t.$viewValue[r]=1),Array.isArray(e)||_.includes(r.toLowerCase(),"page")||(t.$viewValue[r]=null)});var e=r.tableState();return e.search.predicateObject={},e.pagination.start=0,r.pipe()})})}}}),e.directive("stClearKey",function(){return{restrict:"EA",require:["^stTable","^ngModel"],link:function(e,t,r,n){t.on("keydown",function(r){var i=n[1],a=n[0];return 13===r.which?a.pipe():27===r.which?void 0!==t.context.attributes["st-search"]?e.$apply(function(){var e=t.context.attributes["st-search"].value,r=a.tableState();return r.search.predicateObject[e]="",a.pipe()}):e.$apply(function(){i.$setViewValue(null),i.$render()}):void 0})}}})}();
!function(){angular.module("shared.components",[])}();
!function(){function n(n,o){var e=this;e.$onInit=function(){n.get("api/publisher").then(function(n){e.publishers=n.data}).catch(function(n){console.log(n.message)})},e.create=function(){o.open({component:"publisherEdit",bindings:{modalInstance:"<"},size:"lg"}).result.then(function(n){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),console.info("returning result",n),e.publishers.unshift(n),e.id=n.id},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})},e.edit=function(){o.open({component:"publisherEdit",bindings:{modalInstance:"<"},resolve:{id:e.id},size:"lg"}).result.then(function(n){angular.forEach(e.publishers,function(o){o.id===e.id&&(angular.extend(o,n),e.id=o.id)})},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})}}var o=angular.module("shared.components");o.component("publisherSelect",{bindings:{id:"="},templateUrl:"app/common/publisher-select.component.html",controller:["$http","$uibModal",n]})}();
!function(){"use strict";function t(t){function n(n){return t.get("api/product/"+n).then(function(t){return t.data}).catch(function(t){console.log(t.message)})}function e(n){return t.get("api/product",{params:n}).then(function(t){return t.data}).catch(function(t){console.log(t.message)})}function u(n){return t.delete("api/product/"+n).then(function(t){return t.data}).catch(function(t){console.log(t.message)})}function c(n){return n.id?t.put("api/product",n).then(function(t){return t.data}).catch(function(t){return t.message}):t.post("api/product",n).then(function(t){return t.data}).catch(function(t){return t.message})}return{getProduct:n,getAllProducts:e,remove:u,save:c}}var n=angular.module("app");n.factory("Product",["$http",t])}();
!function(){function t(t){var n=this;n.$onInit=function(){n.title="New Product",n.resolve&&(n.id=n.resolve.id),n.id&&t.getProduct(n.id).then(function(t){n.product=t,n.title=t.title})},n.cancel=function(){n.dismiss()},n.save=function(){return t.save(n.product).then(function(t){angular.extend(n.product,t)}).catch(function(t){console.log("Error saving product",t.message)}).finally(function(){n.modalInstance.close(n.product)})}}var n=angular.module("app");n.component("productEdit",{templateUrl:"app/product/product-edit.component.html",bindings:{id:"<",resolve:"<",close:"&",dismiss:"&",modalInstance:"<"},controller:["Product",t]})}();
!function(){"use strict";function o(o,n){var e,t=this,s=10;t.searchModel={page:1,pageSize:s},t.$onInit=function(){console.log("product list init"),t.title="Product List"},t.search=function(o){e=o,console.log("search"),n.getAllProducts(t.searchModel).then(function(o){t.products=o.results,t.searchModel=o,delete t.searchModel.results})},t.paged=function(){t.search(e)},t.create=function(){o.open({component:"productEdit",bindings:{modalInstance:"<"},size:"md"}).result.then(function(o){t.products.unshift(o)},function(o){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+o)})},t.edit=function(n){o.open({component:"productEdit",bindings:{modalInstance:"<"},resolve:{id:n.id},size:"md"}).result.then(function(o){angular.extend(n,o)},function(o){})},t.delete=function(o){console.log("delete",o),n.remove(o.id).then(function(n){var e=t.products.indexOf(o);t.products.splice(e,1)})},t.showDetails=function(n){o.open({component:"productSummary",bindings:{modalInstance:"<"},resolve:{id:n,asModal:!0},size:"md"}).result.then(function(o){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),console.info(o)},function(o){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+o)})}}var n=angular.module("app");n.component("productList",{templateUrl:"app/product/product-list.component.html",controller:["$uibModal","Product",o]})}();
!function(){function o(o,n){var t=this;t.$onInit=function(){t.resolve&&(t.id=t.resolve.id,t.asModal=t.resolve.asModal,t.addStaffVisible=!1),n.getProduct(t.id).then(function(o){t.product=o})},t.showNewStaff=function(){o.open({component:"staffEdit",bindings:{modalInstance:"<"},resolve:{productId:t.id},size:"md"}).result.then(function(o){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),t.product.staff.unshift(o)},function(o){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+o)})},t.cancel=function(){t.dismiss()}}var n=angular.module("app");n.component("productSummary",{bindings:{id:"<",asModal:"<",resolve:"<",close:"&",dismiss:"&"},templateUrl:"app/product/product-summary.component.html",controller:["$uibModal","Product",o]})}();
!function(){function t(t){var a=this;a.$onInit=function(){console.log("staff edit init"),a.title="New Staff",a.resolve&&(a.productId=a.resolve.productId),a.resolve.staff&&(a.staff=a.resolve.staff,a.title=a.staff.firstname+" "+a.staff.lastname)},a.cancel=function(){a.dismiss()},a.save=function(){a.productId?t.post("api/staff/"+a.productId,a.staff).then(function(t){angular.extend(a.staff,t.data),a.modalInstance.close(t.data)}).catch(function(t){console.log("something went wrong",t.message)}):t.post("api/staff",a.staff).then(function(t){angular.extend(a.staff,t.data),a.modalInstance.close(t.data)}).catch(function(t){console.log("something went wrong",t.message)})}}var a=angular.module("app");a.component("staffEdit",{bindings:{resolve:"<",close:"&",dismiss:"&",staff:"<",productId:"<",modalInstance:"<"},templateUrl:"app/staff/staff-edit.component.html",controller:["$http",t]})}();
!function(){function n(n,t){var o=this;o.$onInit=function(){console.log("staff list init")},o.edit=function(n){t.open({component:"staffEdit",bindings:{modalInstance:"<",staff:n},resolve:{staff:n},size:"md"}).result.then(function(n){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->")},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})},o.delete=function(t){n.delete("api/staff/"+t.id).then(function(n){var e=o.staff.indexOf(t);o.staff.splice(e,1)}).catch(function(n){console.log("error",n.message)})}}var t=angular.module("app");t.component("staffList",{bindings:{staff:"<"},templateUrl:"app/staff/staff-list.component.html",controller:["$http","$uibModal",n]})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJkaXJlY3RpdmVzL2RpcmVjdGl2ZXMubW9kdWxlcy5qcyIsImRpcmVjdGl2ZXMvc3RUYWJsZS5kaXJlY3RpdmUuanMiLCJjb21tb24vY29tcG9uZW50cy5tb2R1bGUuanMiLCJjb21tb24vcHVibGlzaGVyLXNlbGVjdC5jb21wb25lbnQuanMiLCJzZXJ2aWNlcy9wcm9kdWN0LnNlcnZpY2UuanMiLCJwcm9kdWN0L3Byb2R1Y3QtZWRpdC5jb21wb25lbnQuanMiLCJwcm9kdWN0L3Byb2R1Y3QtbGlzdC5jb21wb25lbnQuanMiLCJwcm9kdWN0L3Byb2R1Y3Qtc3VtbWFyeS5jb21wb25lbnQuanMiLCJzdGFmZi9zdGFmZi1lZGl0LmNvbXBvbmVudC5qcyIsInN0YWZmL3N0YWZmLWxpc3QuY29tcG9uZW50LmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJkaXJlY3RpdmUiLCJzdENvbmZpZyIsIiR0aW1lb3V0IiwiJHBhcnNlIiwicmVxdWlyZSIsImxpbmsiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRyIiwiY3RybCIsImJpbmQiLCJ0YWJsZUN0cmwiLCJwaXBlIiwicmVzdHJpY3QiLCJlbCIsImF0dHJzIiwib24iLCJldmVudCIsIndoaWNoIiwiJHNldFZpZXdWYWx1ZSIsIiRyZW5kZXIiLCIkYXBwbHkiLCJjdHJscyIsIm1vZGVsIiwiZm9yRWFjaCIsIiR2aWV3VmFsdWUiLCJ2YWx1ZSIsImtleSIsInRvTG93ZXJDYXNlIiwiQXJyYXkiLCJpc0FycmF5IiwiXyIsImluY2x1ZGVzIiwidGFibGVTdGF0ZSIsInNlYXJjaCIsInByZWRpY2F0ZU9iamVjdCIsInBhZ2luYXRpb24iLCJzdGFydCIsIm5nTW9kZWwiLCJ1bmRlZmluZWQiLCJjb250ZXh0IiwiYXR0cmlidXRlcyIsImZpZWxkTmFtZSIsImNvbnRyb2xsZXIiLCIkaHR0cCIsIiR1aWJNb2RhbCIsIiRjdHJsIiwidGhpcyIsIiRvbkluaXQiLCJnZXQiLCJ0aGVuIiwiciIsInB1Ymxpc2hlcnMiLCJkYXRhIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwibWVzc2FnZSIsImNyZWF0ZSIsIm9wZW4iLCJjb21wb25lbnQiLCJiaW5kaW5ncyIsIm1vZGFsSW5zdGFuY2UiLCJzaXplIiwicmVzdWx0IiwiaW5mbyIsInVuc2hpZnQiLCJpZCIsInJlYXNvbiIsImVkaXQiLCJyZXNvbHZlIiwiaXRlbSIsImV4dGVuZCIsInRlbXBsYXRlVXJsIiwic2VydmljZUNvbnRyb2xsZXIiLCJnZXRQcm9kdWN0IiwiZ2V0QWxsUHJvZHVjdHMiLCJzZWFyY2hNb2RlbCIsInBhcmFtcyIsInJlbW92ZSIsImRlbGV0ZSIsInNhdmUiLCJwcm9kdWN0IiwicHV0IiwicG9zdCIsImZhY3RvcnkiLCJzZXJ2aWNlIiwidGl0bGUiLCJjYW5jZWwiLCJkaXNtaXNzIiwiZmluYWxseSIsImNsb3NlIiwiJG1vZGFsIiwidGFibGVTdGF0ZVJlZiIsInBhZ2VTaXplRGVmYXVsdCIsInBhZ2UiLCJwYWdlU2l6ZSIsInByb2R1Y3RzIiwicmVzdWx0cyIsInBhZ2VkIiwiaWR4IiwiaW5kZXhPZiIsInNwbGljZSIsInNob3dEZXRhaWxzIiwiYXNNb2RhbCIsImFkZFN0YWZmVmlzaWJsZSIsInNob3dOZXdTdGFmZiIsInByb2R1Y3RJZCIsInN0YWZmIiwiZmlyc3RuYW1lIiwibGFzdG5hbWUiLCJtZW1iZXIiXSwibWFwcGluZ3MiOiJDQUNBLFdBQ0ksWUFFYUEsU0FBUUMsT0FBTyxPQUN4QixpQkFDQSxvQkFDQSxlQUNBO0NDUFIsV0FDSUQsUUFBUUMsT0FBTztDQ0RuQixXQUVJLEdBQUlBLEdBQVNELFFBQVFDLE9BQU8saUJBRTVCQSxHQUFPQyxVQUFVLGtCQUFtQixXQUFZLFdBQVksU0FBVSxTQUFVQyxFQUFVQyxFQUFVQyxHQUNoRyxPQUNJQyxRQUFTLFdBQ1RDLEtBQU0sU0FBVUMsRUFBT0MsRUFBU0MsRUFBTUMsR0FDbEMsTUFBT0YsR0FBUUcsS0FBSyxRQUNoQixXQUNJLEdBQUlDLEdBQVlGLENB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QU1QLFFBQVFVLEVBQzlCbEUsR0FBTStELE1BQU1OLE9BQU9GLEVBQUssS0FDekIvQyxNQUFNLFNBQVNDLEdBQ2RDLFFBQVFDLElBQUksUUFBU0YsRUFBSUcsWUFqQ3JDLEdBQUkzRCxHQUFTRCxRQUFRQyxPQUFPLE1BdUM1QkEsR0FBTzhELFVBQVUsYUFFVEMsVUFDSStDLE1BQU8sS0FFWG5DLFlBQWEsc0NBQ2IvQixZQUFhLFFBQVMsWUFBYUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vYXBwLm1vZHVsZS5qc1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbXHJcbiAgICAgICAgJ2FwcC5kaXJlY3RpdmVzJyxcclxuICAgICAgICAnc2hhcmVkLmNvbXBvbmVudHMnLFxyXG4gICAgICAgICd1aS5ib290c3RyYXAnLCBcclxuICAgICAgICAnc21hcnQtdGFibGUnXHJcbiAgICBdKTtcclxuXHJcblxyXG59KSgpOyIsIi8vZGlyZWN0aXZlcy5tb2R1bGVzLmpzXHJcbihmdW5jdGlvbigpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycsIFtdKTsgXHJcbn0pKCk7IiwiLy9zdFRhYmxlLmRpcmVjdGl2ZS5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwLmRpcmVjdGl2ZXMnKTtcclxuXHJcbiAgICBtb2R1bGUuZGlyZWN0aXZlKCdzdFN1Ym1pdFNlYXJjaCcsIFsnc3RDb25maWcnLCAnJHRpbWVvdXQnLCAnJHBhcnNlJywgZnVuY3Rpb24gKHN0Q29uZmlnLCAkdGltZW91dCwgJHBhcnNlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVxdWlyZTogJ15zdFRhYmxlJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRyLCBjdHJsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5iaW5kKCdjbGljaycsXHJcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVDdHJsID0gY3RybDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVDdHJsLnBpcGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xyXG5cclxuICAgIG1vZHVsZS5kaXJlY3RpdmUoXCJjbGVhcktleVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgIGVsLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoICE9PSAyNykgeyByZXR1cm47IH0gLy8gY2hlY2sga2V5IGhvdyB5b3Ugd2FudFxyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZpZXdWYWx1ZShudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLiRyZW5kZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICBtb2R1bGUuZGlyZWN0aXZlKFwic3RSZXNldFNlYXJjaFwiLFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmU6IFsnXnN0VGFibGUnLCAnXm5nTW9kZWwnXSxcclxuICAgICAgICAgICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJscykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5iaW5kKCdjbGljaycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGVsID0gY3RybHNbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN0cmwgPSBjdHJsc1swXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChtb2RlbC4kdmlld1ZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5LnRvTG93ZXJDYXNlKCkgPT09ICdwYWdlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC4kdmlld1ZhbHVlW2tleV0gPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgXy5pbmNsdWRlcyhrZXkudG9Mb3dlckNhc2UoKSwgJ3BhZ2UnKSkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLiR2aWV3VmFsdWVba2V5XSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlU3RhdGUgPSBjdHJsLnRhYmxlU3RhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0ID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlU3RhdGUucGFnaW5hdGlvbi5zdGFydCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdHJsLnBpcGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgIG1vZHVsZS5kaXJlY3RpdmUoXCJzdENsZWFyS2V5XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogWydec3RUYWJsZScsICdebmdNb2RlbCddLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJscykge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZ01vZGVsID0gY3RybHNbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN0cmwgPSBjdHJsc1swXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSAxMykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3RybC5waXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC53aGljaCA9PT0gMjcpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmNvbnRleHQuYXR0cmlidXRlc1snc3Qtc2VhcmNoJ10gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkTmFtZSA9IGVsZW1lbnQuY29udGV4dC5hdHRyaWJ1dGVzWydzdC1zZWFyY2gnXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVTdGF0ZSA9IGN0cmwudGFibGVTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdFtmaWVsZE5hbWVdID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kc2V0Vmlld1ZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHJlbmRlcigpOyAvLyB3aWxsIHVwZGF0ZSB0aGUgaW5wdXQgdmFsdWUgYXMgd2VsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG59XHJcbikoKTsiLCIvL3NoYXJlZC1jb21wb25lbnRzLm1vZHVsZS5qc1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdzaGFyZWQuY29tcG9uZW50cycsIFtdKTtcclxuICAgIH1cclxuKSgpOyIsIi8vcHVibGlzaGVyLWxpc3QuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdzaGFyZWQuY29tcG9uZW50cycpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJGh0dHAsICR1aWJNb2RhbCkge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL3B1Ymxpc2hlcicpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnB1Ymxpc2hlcnMgPSByLmRhdGE7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ3B1Ymxpc2hlckVkaXQnLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdsZydcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgY2xvc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlc3VsdCB3YXMtPlwiKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbygncmV0dXJuaW5nIHJlc3VsdCcsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5wdWJsaXNoZXJzLnVuc2hpZnQocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlkID0gcmVzdWx0LmlkO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBkaW1pc3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZWFzb24gd2FzLT5cIiArIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuZWRpdCA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ3B1Ymxpc2hlckVkaXQnLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogJGN0cmwuaWRcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbGcnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkY3RybC5wdWJsaXNoZXJzLCBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmlkID09PSAkY3RybC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChpdGVtLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkY3RybC5pZCA9IGl0ZW0uaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBkaW1pc3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZWFzb24gd2FzLT5cIiArIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdwdWJsaXNoZXJTZWxlY3QnLFxyXG4gICAge1xyXG4gICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgIGlkOiAnPSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2NvbW1vbi9wdWJsaXNoZXItc2VsZWN0LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOiBbJyRodHRwJywgJyR1aWJNb2RhbCcsIGNvbnRyb2xsZXJdXHJcbiAgICB9KTtcclxuXHJcblxyXG59XHJcbikoKTsiLCIvL3Byb2R1Y3Quc2VydmljZS5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTsgXHJcbiAgICBcclxuICAgIG1vZHVsZS5mYWN0b3J5KCdQcm9kdWN0JywgWyckaHR0cCcsIHNlcnZpY2VDb250cm9sbGVyXSk7XHJcblxyXG4gICAgZnVuY3Rpb24gc2VydmljZUNvbnRyb2xsZXIoJGh0dHApIHtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0UHJvZHVjdDogZ2V0UHJvZHVjdCxcclxuICAgICAgICAgICAgZ2V0QWxsUHJvZHVjdHM6IGdldEFsbFByb2R1Y3RzLFxyXG4gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSwgXHJcbiAgICAgICAgICAgIHNhdmU6IHNhdmVcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRQcm9kdWN0KGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJ2FwaS9wcm9kdWN0LycgKyBpZCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHIuZGF0YTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEFsbFByb2R1Y3RzKHNlYXJjaE1vZGVsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJ2FwaS9wcm9kdWN0JywgeyBwYXJhbXM6IHNlYXJjaE1vZGVsIH0pLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByLmRhdGE7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUoaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSgnYXBpL3Byb2R1Y3QvJyArIGlkKS50aGVuKGZ1bmN0aW9uKHIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByLmRhdGE7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTsgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlKHByb2R1Y3QpIHtcclxuICAgICAgICAgICAgaWYgKHByb2R1Y3QuaWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJ2FwaS9wcm9kdWN0JywgcHJvZHVjdCkudGhlbihmdW5jdGlvbihyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnIubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJ2FwaS9wcm9kdWN0JywgcHJvZHVjdCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVyci5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxufVxyXG4pKCk7IiwiLy9wcm9kdWN0LWVkaXQuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoc2VydmljZSkge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLnRpdGxlID0gJ05ldyBQcm9kdWN0JzsgXHJcbiAgICAgICAgICAgIGlmICgkY3RybC5yZXNvbHZlKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5pZCA9ICRjdHJsLnJlc29sdmUuaWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCRjdHJsLmlkKSB7XHJcbiAgICAgICAgICAgICAgICBzZXJ2aWNlLmdldFByb2R1Y3QoJGN0cmwuaWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICAkY3RybC5wcm9kdWN0ID0gcjtcclxuICAgICAgICAgICAgICAgICAgICAkY3RybC50aXRsZSA9IHIudGl0bGU7IFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlLnNhdmUoJGN0cmwucHJvZHVjdCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoJGN0cmwucHJvZHVjdCwgcik7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBzYXZpbmcgcHJvZHVjdCcsIGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKCRjdHJsLnByb2R1Y3QpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ3Byb2R1Y3RFZGl0JyxcclxuICAgIHtcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9wcm9kdWN0L3Byb2R1Y3QtZWRpdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgaWQ6ICc8JyxcclxuICAgICAgICAgICAgcmVzb2x2ZTogJzwnLFxyXG4gICAgICAgICAgICBjbG9zZTogJyYnLFxyXG4gICAgICAgICAgICBkaXNtaXNzOiAnJicsXHJcbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6ICc8J1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29udHJvbGxlcjogWydQcm9kdWN0JywgY29udHJvbGxlcl1cclxuICAgIH0pO1xyXG59KSgpO1xyXG4gICAgIiwiLy9wcm9kdWN0LWxpc3QuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRtb2RhbCwgcHJvZHVjdCkge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHBhZ2VTaXplRGVmYXVsdCA9IDEwO1xyXG4gICAgICAgIHZhciB0YWJsZVN0YXRlUmVmO1xyXG5cclxuICAgICAgICAkY3RybC5zZWFyY2hNb2RlbCA9IHtcclxuICAgICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplRGVmYXVsdFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwcm9kdWN0IGxpc3QgaW5pdCcpO1xyXG4gICAgICAgICAgICAkY3RybC50aXRsZSA9ICdQcm9kdWN0IExpc3QnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuc2VhcmNoID0gZnVuY3Rpb24gKHRhYmxlU3RhdGUpIHtcclxuICAgICAgICAgICAgdGFibGVTdGF0ZVJlZiA9IHRhYmxlU3RhdGU7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZWFyY2gnKTtcclxuICAgICAgICAgICAgcHJvZHVjdC5nZXRBbGxQcm9kdWN0cygkY3RybC5zZWFyY2hNb2RlbCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwucHJvZHVjdHMgPSByLnJlc3VsdHM7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5zZWFyY2hNb2RlbCA9IHI7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgJGN0cmwuc2VhcmNoTW9kZWwucmVzdWx0cztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5wYWdlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGN0cmwuc2VhcmNoKHRhYmxlU3RhdGVSZWYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdwcm9kdWN0RWRpdCcsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ21kJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5wcm9kdWN0cy51bnNoaWZ0KHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGRpbWlzc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlYXNvbiB3YXMtPlwiICsgcmVhc29uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5lZGl0ID0gZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdwcm9kdWN0RWRpdCcsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBpdGVtLmlkXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ21kJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChpdGVtLCByZXN1bHQpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuZGVsZXRlID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGUnLCBpdGVtKTtcclxuICAgICAgICAgICAgcHJvZHVjdC5yZW1vdmUoaXRlbS5pZCkudGhlbihmdW5jdGlvbihyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaWR4ID0gJGN0cmwucHJvZHVjdHMuaW5kZXhPZihpdGVtKTtcclxuICAgICAgICAgICAgICAgICRjdHJsLnByb2R1Y3RzLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9ICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgJGN0cmwuc2hvd0RldGFpbHMgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAncHJvZHVjdFN1bW1hcnknLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgYXNNb2RhbDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgY2xvc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlc3VsdCB3YXMtPlwiKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhyZXN1bHQpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBkaW1pc3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZWFzb24gd2FzLT5cIiArIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdwcm9kdWN0TGlzdCcsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9wcm9kdWN0L3Byb2R1Y3QtbGlzdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJHVpYk1vZGFsJywgJ1Byb2R1Y3QnLCBjb250cm9sbGVyXVxyXG4gICAgICAgIH0pO1xyXG5cclxufVxyXG4pKCk7IiwiLy9wcm9kdWN0LXN1bW1hcnkuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJG1vZGFsLCBzZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlkID0gJGN0cmwucmVzb2x2ZS5pZDtcclxuICAgICAgICAgICAgICAgICRjdHJsLmFzTW9kYWwgPSAkY3RybC5yZXNvbHZlLmFzTW9kYWw7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5hZGRTdGFmZlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2VydmljZS5nZXRQcm9kdWN0KCRjdHJsLmlkKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5wcm9kdWN0ID0gcjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5zaG93TmV3U3RhZmYgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnc3RhZmZFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdElkOiAkY3RybC5pZFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgY2xvc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlc3VsdCB3YXMtPlwiKTtcclxuICAgICAgICAgICAgICAgICRjdHJsLnByb2R1Y3Quc3RhZmYudW5zaGlmdChyZXN1bHQpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBkaW1pc3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZWFzb24gd2FzLT5cIiArIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdwcm9kdWN0U3VtbWFyeScsXHJcbiAgICB7XHJcbiAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgaWQ6ICc8JyxcclxuICAgICAgICAgICAgYXNNb2RhbDogJzwnLFxyXG4gICAgICAgICAgICByZXNvbHZlOiAnPCcsXHJcbiAgICAgICAgICAgIGNsb3NlOiAnJicsXHJcbiAgICAgICAgICAgIGRpc21pc3M6ICcmJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvcHJvZHVjdC9wcm9kdWN0LXN1bW1hcnkuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgIGNvbnRyb2xsZXI6IFsnJHVpYk1vZGFsJywgJ1Byb2R1Y3QnLCBjb250cm9sbGVyXVxyXG4gICAgfSk7XHJcblxyXG59XHJcbikoKTsiLCIvL3N0YWZmLWVkaXQuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJGh0dHApIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3RhZmYgZWRpdCBpbml0Jyk7XHJcbiAgICAgICAgICAgICRjdHJsLnRpdGxlID0gJ05ldyBTdGFmZic7XHJcblxyXG4gICAgICAgICAgICBpZiAoJGN0cmwucmVzb2x2ZSkgJGN0cmwucHJvZHVjdElkID0gJGN0cmwucmVzb2x2ZS5wcm9kdWN0SWQ7XHJcblxyXG4gICAgICAgICAgICBpZiAoJGN0cmwucmVzb2x2ZS5zdGFmZikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuc3RhZmYgPSAkY3RybC5yZXNvbHZlLnN0YWZmO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwudGl0bGUgPSAkY3RybC5zdGFmZi5maXJzdG5hbWUgKyAnICcgKyAkY3RybC5zdGFmZi5sYXN0bmFtZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJGN0cmwuc2F2ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCRjdHJsLnByb2R1Y3RJZCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnYXBpL3N0YWZmLycgKyAkY3RybC5wcm9kdWN0SWQsICRjdHJsLnN0YWZmKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoJGN0cmwuc3RhZmYsIHIuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwubW9kYWxJbnN0YW5jZS5jbG9zZShyLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzb21ldGhpbmcgd2VudCB3cm9uZycsIGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnYXBpL3N0YWZmJywgJGN0cmwuc3RhZmYpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCgkY3RybC5zdGFmZiwgci5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKHIuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NvbWV0aGluZyB3ZW50IHdyb25nJywgZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ3N0YWZmRWRpdCcsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZTogJzwnLFxyXG4gICAgICAgICAgICAgICAgY2xvc2U6ICcmJyxcclxuICAgICAgICAgICAgICAgIGRpc21pc3M6ICcmJyxcclxuICAgICAgICAgICAgICAgIHN0YWZmOiAnPCcsXHJcbiAgICAgICAgICAgICAgICBwcm9kdWN0SWQ6ICc8JyxcclxuICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6ICc8J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9zdGFmZi9zdGFmZi1lZGl0LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsIGNvbnRyb2xsZXJdXHJcbiAgICAgICAgfSk7XHJcbn1cclxuKSgpOyIsIi8vc3RhZmYtbGlzdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCwgJG1vZGFsKSB7XHJcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0YWZmIGxpc3QgaW5pdCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuZWRpdCA9IGZ1bmN0aW9uKG1lbWJlcikge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdzdGFmZkVkaXQnLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIiwgXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhZmY6IG1lbWJlclxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBzdGFmZjogbWVtYmVyXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ21kJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBjbG9zZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVzdWx0IHdhcy0+XCIpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGRpbWlzc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlYXNvbiB3YXMtPlwiICsgcmVhc29uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5kZWxldGUgPSBmdW5jdGlvbihtZW1iZXIpIHtcclxuICAgICAgICAgICAgJGh0dHAuZGVsZXRlKCdhcGkvc3RhZmYvJyArIG1lbWJlci5pZCkudGhlbihmdW5jdGlvbihyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaWR4ID0gJGN0cmwuc3RhZmYuaW5kZXhPZihtZW1iZXIpO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuc3RhZmYuc3BsaWNlKGlkeCwgMSk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yJywgZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ3N0YWZmTGlzdCcsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgc3RhZmY6ICc8J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9zdGFmZi9zdGFmZi1saXN0LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsICckdWliTW9kYWwnLCBjb250cm9sbGVyXVxyXG4gICAgICAgIH0pO1xyXG59XHJcbikoKTsiXX0=
