!function(){"use strict";var t=angular.module("app",["ngStorage","app.directives","shared.components","ui.bootstrap","smart-table","cp.ngConfirm","treasure-overlay-spinner","toastr"]);t.config(["toastrConfig",function(t){angular.extend(t,{positionClass:"toast-bottom-right",newestOnTop:!0,allowHtml:!1,closeButton:!1,closeHtml:"<button>&times;</button>",extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},messageClass:"toast-message",onHidden:null,onShown:null,onTap:null,progressBar:!1,tapToDismiss:!0,templates:{toast:"directives/toast/toast.html",progressbar:"directives/progressbar/progressbar.html"},timeOut:5e3,titleClass:"toast-title",toastClass:"toast"})}])}();
!function(){angular.module("shared.components",[])}();
!function(){function n(){var n=this;n.$onInit=function(){console.log("modal",n)}}var o=angular.module("app");o.component("confirmationModal",{bindings:{},template:"yes or no",controller:[n]})}();
!function(){function n(n,o){var e=this;e.$onInit=function(){n.get("api/publisher").then(function(n){e.publishers=n.data}).catch(function(n){console.log(n.message)})},e.create=function(){o.open({component:"publisherEdit",bindings:{modalInstance:"<"},size:"lg"}).result.then(function(n){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),console.info("returning result",n),e.publishers.unshift(n),e.id=n.id},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})},e.edit=function(){o.open({component:"publisherEdit",bindings:{modalInstance:"<"},resolve:{id:e.id},size:"lg"}).result.then(function(n){angular.forEach(e.publishers,function(o){o.id===e.id&&(angular.extend(o,n),e.id=o.id)})},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})}}var o=angular.module("shared.components");o.component("publisherSelect",{bindings:{id:"="},templateUrl:"app/common/publisher-select.component.html",controller:["$http","$uibModal",n]})}();
!function(){angular.module("app.directives",[])}();
!function(){var e=angular.module("app.directives");e.directive("stSubmitSearch",["stConfig","$timeout","$parse",function(e,t,r){return{require:"^stTable",link:function(e,t,r,n){return t.bind("click",function(){var e=n;e.pipe()})}}}]),e.directive("clearKey",function(){return{restrict:"EA",require:"ngModel",link:function(e,t,r,n){t.on("keydown",function(t){27===t.which&&(n.$setViewValue(null),n.$render(),e.$apply())})}}}),e.directive("stResetSearch",function(){return{restrict:"EA",require:["^stTable","^ngModel"],link:function(e,t,r,n){return t.bind("click",function(){var t=n[1],r=n[0];return e.$apply(function(){angular.forEach(t.$viewValue,function(e,r){"page"===r.toLowerCase()&&(t.$viewValue[r]=1),Array.isArray(e)||_.includes(r.toLowerCase(),"page")||(t.$viewValue[r]=null)});var e=r.tableState();return e.search.predicateObject={},e.pagination.start=0,r.pipe()})})}}}),e.directive("stClearKey",function(){return{restrict:"EA",require:["^stTable","^ngModel"],link:function(e,t,r,n){t.on("keydown",function(r){var i=n[1],a=n[0];return 13===r.which?a.pipe():27===r.which?void 0!==t.context.attributes["st-search"]?e.$apply(function(){var e=t.context.attributes["st-search"].value,r=a.tableState();return r.search.predicateObject[e]="",a.pipe()}):e.$apply(function(){i.$setViewValue(null),i.$render()}):void 0})}}})}();
!function(){function t(t){var o=this;o.$onInit=function(){o.title="New Product",o.resolve&&(o.id=o.resolve.id),o.id&&t.getProduct(o.id).then(function(t){o.product=t,o.title=t.title})},o.cancel=function(){o.dismiss()},o.save=function(){return t.save(o.product).then(function(t){angular.extend(o.product,t),console.log("save product",o.product),o.modalInstance.close(o.product)}).catch(function(t){console.log("Error saving product",t.message)}).finally(function(){})}}var o=angular.module("app");o.component("productEdit",{templateUrl:"app/product/product-edit.component.html",bindings:{id:"<",resolve:"<",close:"&",dismiss:"&",modalInstance:"<"},controller:["Product",t]})}();
!function(){"use strict";function n(n,t,o,e){var i,s=this,d=10;s.searchModel={page:1,pageSize:d,filteredCount:0,totalCount:0,totalPages:0},s.$onInit=function(){console.log("product list init"),s.title="Media Library",s.loading=!0},s.search=function(n){s.loading=!0,i=n,e.getAllProducts(s.searchModel).then(function(n){s.products=n.results,s.searchModel=n,delete s.searchModel.results,s.loading=!1}).catch(function(n){s.loading=!1}).finally(function(){})},s.paged=function(){s.search(i)},s.create=function(){n.open({component:"productEdit",bindings:{modalInstance:"<"},size:"md"}).result.then(function(n){s.products.unshift(n),o.info("Created "+n.title)},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})},s.edit=function(t){n.open({component:"productEdit",bindings:{modalInstance:"<"},resolve:{id:t.id},size:"md"}).result.then(function(n){angular.extend(t,n),o.info("Saved "+n.title)},function(n){})},s.delete=function(n){t({title:"Delete",content:"Are you sure you want to delete <br /><strong>"+n.title+"</strong>?",type:"red",buttons:{yes:{keys:["y"],action:function(t,i){e.remove(n.id).then(function(t){var e=s.products.indexOf(n);s.products.splice(e,1),o.warning("Deleted "+n.title)})}},no:{keys:["N"],action:function(n,t){}}}})},s.showDetails=function(t){n.open({component:"productSummary",bindings:{modalInstance:"<"},resolve:{id:t.id,asModal:!0},size:"md"}).result.then(function(n){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),angular.extend(t,n)},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})}}var t=angular.module("app");t.component("productList",{templateUrl:"app/product/product-list.component.html",controller:["$uibModal","$ngConfirm","toastr","Product",n]})}();
!function(){function o(o,n){var t=this;t.$onInit=function(){t.loading=!0,t.resolve&&(t.id=t.resolve.id,t.asModal=t.resolve.asModal,t.addStaffVisible=!1),n.getProduct(t.id).then(function(o){t.product=o,t.loading=!1})},t.edit=function(){o.open({component:"productEdit",bindings:{modalInstance:"<"},resolve:{id:t.product.id},size:"md"}).result.then(function(o){angular.extend(t.product,o)},function(o){})},t.showNewStaff=function(){o.open({component:"staffEdit",bindings:{modalInstance:"<"},resolve:{productId:t.id},size:"md"}).result.then(function(o){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),t.product.staff.unshift(o)},function(o){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+o)})},t.cancel=function(){t.modalInstance.close(t.product)}}var n=angular.module("app");n.component("productSummary",{bindings:{id:"<",asModal:"<",resolve:"<",close:"&",dismiss:"&",modalInstance:"<"},templateUrl:"app/product/product-summary.component.html",controller:["$uibModal","Product",o]})}();
!function(){"use strict";function t(t){function n(n){return t.get("api/product/"+n).then(function(t){return t.data}).catch(function(t){console.log(t.message)})}function e(n){return t.get("api/product",{params:n}).then(function(t){return t.data}).catch(function(t){console.log(t.message)})}function u(n){return t.delete("api/product/"+n).then(function(t){return t.data}).catch(function(t){console.log(t.message)})}function c(n){return n.id?t.put("api/product",n).then(function(t){return t.data}).catch(function(t){return t.message}):t.post("api/product",n).then(function(t){return t.data}).catch(function(t){return t.message})}return{getProduct:n,getAllProducts:e,remove:u,save:c}}var n=angular.module("app");n.factory("Product",["$http",t])}();
!function(){function t(t){var a=this;a.$onInit=function(){console.log("staff edit init"),a.title="New Staff",a.resolve&&(a.productId=a.resolve.productId),a.resolve.staff&&(a.staff=a.resolve.staff,a.title=a.staff.firstname+" "+a.staff.lastname)},a.cancel=function(){a.dismiss()},a.save=function(){a.productId?t.post("api/staff/"+a.productId,a.staff).then(function(t){angular.extend(a.staff,t.data),a.modalInstance.close(t.data)}).catch(function(t){console.log("something went wrong",t.message)}):t.post("api/staff",a.staff).then(function(t){angular.extend(a.staff,t.data),a.modalInstance.close(t.data)}).catch(function(t){console.log("something went wrong",t.message)})}}var a=angular.module("app");a.component("staffEdit",{bindings:{resolve:"<",close:"&",dismiss:"&",staff:"<",productId:"<",modalInstance:"<"},templateUrl:"app/staff/staff-edit.component.html",controller:["$http",t]})}();
!function(){function t(t,n,o){var e=this;e.$onInit=function(){console.log("staff list init")},e.edit=function(t){n.open({component:"staffEdit",bindings:{modalInstance:"<",staff:t},resolve:{staff:t},size:"md"}).result.then(function(t){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->")},function(t){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+t)})},e.delete=function(n){o({title:"Delete",content:"Are you sure you want to delete <br /><strong>"+n.firstname+n.lastname+"</strong>?",type:"red",buttons:{yes:{keys:["y"],action:function(o,s){t.delete("api/staff/"+n.id).then(function(t){var o=e.staff.indexOf(n);e.staff.splice(o,1)}).catch(function(t){console.log("error",t.message)})}},no:{keys:["N"],action:function(t,n){}}}})}}var n=angular.module("app");n.component("staffList",{bindings:{staff:"<"},templateUrl:"app/staff/staff-list.component.html",controller:["$http","$uibModal","$ngConfirm",t]})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJjb21tb24vY29tcG9uZW50cy5tb2R1bGUuanMiLCJjb21tb24vY29uZnJtYXRpb24tbW9kYWwuY29tcG9uZW50LmpzIiwiY29tbW9uL3B1Ymxpc2hlci1zZWxlY3QuY29tcG9uZW50LmpzIiwiZGlyZWN0aXZlcy9kaXJlY3RpdmVzLm1vZHVsZXMuanMiLCJkaXJlY3RpdmVzL3N0VGFibGUuZGlyZWN0aXZlLmpzIiwicHJvZHVjdC9wcm9kdWN0LWVkaXQuY29tcG9uZW50LmpzIiwicHJvZHVjdC9wcm9kdWN0LWxpc3QuY29tcG9uZW50LmpzIiwicHJvZHVjdC9wcm9kdWN0LXN1bW1hcnkuY29tcG9uZW50LmpzIiwic2VydmljZXMvcHJvZHVjdC5zZXJ2aWNlLmpzIiwic3RhZmYvc3RhZmYtZWRpdC5jb21wb25lbnQuanMiLCJzdGFmZi9zdGFmZi1saXN0LmNvbXBvbmVudC5qcyJdLCJuYW1lcyI6WyJtb2R1bGUiLCJhbmd1bGFyIiwiY29uZmlnIiwidG9hc3RyQ29uZmlnIiwiZXh0ZW5kIiwicG9zaXRpb25DbGFzcyIsIm5ld2VzdE9uVG9wIiwiYWxsb3dIdG1sIiwiY2xvc2VCdXR0b24iLCJjbG9zZUh0bWwiLCJleHRlbmRlZFRpbWVPdXQiLCJpY29uQ2xhc3NlcyIsImVycm9yIiwiaW5mbyIsInN1Y2Nlc3MiLCJ3YXJuaW5nIiwibWVzc2FnZUNsYXNzIiwib25IaWRkZW4iLCJvblNob3duIiwib25UYXAiLCJwcm9ncmVzc0JhciIsInRhcFRvRGlzbWlzcyIsInRlbXBsYXRlcyIsInRvYXN0IiwicHJvZ3Jlc3NiYXIiLCJ0aW1lT3V0IiwidGl0bGVDbGFzcyIsInRvYXN0Q2xhc3MiLCJjb250cm9sbGVyIiwiJGN0cmwiLCJ0aGlzIiwiJG9uSW5pdCIsImNvbnNvbGUiLCJsb2ciLCJjb21wb25lbnQiLCJiaW5kaW5ncyIsInRlbXBsYXRlIiwiJGh0dHAiLCIkdWliTW9kYWwiLCJnZXQiLCJ0aGVuIiwiciIsInB1Ymxpc2hlcnMiLCJkYXRhIiwiY2F0Y2giLCJlcnIiLCJtZXNzYWdlIiwiY3JlYXRlIiwib3BlbiIsIm1vZGFsSW5zdGFuY2UiLCJzaXplIiwicmVzdWx0IiwidW5zaGlmdCIsImlkIiwicmVhc29uIiwiZWRpdCIsInJlc29sdmUiLCJmb3JFYWNoIiwiaXRlbSIsInRlbXBsYXRlVXJsIiwiZGlyZWN0aXZlIiwic3RDb25maWciLCIkdGltZW91dCIsIiRwYXJzZSIsInJlcXVpcmUiLCJsaW5rIiwic2NvcGUiLCJlbGVtZW50IiwiYXR0ciIsImN0cmwiLCJiaW5kIiwidGFibGVDdHJsIiwicGlwZSIsInJlc3RyaWN0IiwiZWwiLCJhdHRycyIsIm9uIiwiZXZlbnQiLCJ3aGljaCIsIiRzZXRWaWV3VmFsdWUiLCIkcmVuZGVyIiwiJGFwcGx5IiwiY3RybHMiLCJtb2RlbCIsIiR2aWV3VmFsdWUiLCJ2YWx1ZSIsImtleSIsInRvTG93ZXJDYXNlIiwiQXJyYXkiLCJpc0FycmF5IiwiXyIsImluY2x1ZGVzIiwidGFibGVTdGF0ZSIsInNlYXJjaCIsInByZWRpY2F0ZU9iamVjdCIsInBhZ2luYXRpb24iLCJzdGFydCIsIm5nTW9kZWwiLCJ1bmRlZmluZWQiLCJjb250ZXh0IiwiYXR0cmlidXRlcyIsImZpZWxkTmFtZSIsInNlcnZpY2UiLCJ0aXRsZSIsImdldFByb2R1Y3QiLCJwcm9kdWN0IiwiY2FuY2VsIiwiZGlzbWlzcyIsInNhdmUiLCJjbG9zZSIsImZpbmFsbHkiLCIkbW9kYWwiLCIkbmdDb25maXJtIiwidG9hc3RyIiwidGFibGVTdGF0ZVJlZiIsInBhZ2VTaXplRGVmYXVsdCIsInNlYXJjaE1vZGVsIiwicGFnZSIsInBhZ2VTaXplIiwiZmlsdGVyZWRDb3VudCIsInRvdGFsQ291bnQiLCJ0b3RhbFBhZ2VzIiwibG9hZGluZyIsImdldEFsbFByb2R1Y3RzIiwicHJvZHVjdHMiLCJyZXN1bHRzIiwicGFnZWQiLCJkZWxldGUiLCJjb250ZW50IiwidHlwZSIsImJ1dHRvbnMiLCJ5ZXMiLCJrZXlzIiwiYWN0aW9uIiwiYnV0dG9uIiwicmVtb3ZlIiwiaWR4IiwiaW5kZXhPZiIsInNwbGljZSIsIm5vIiwic2hvd0RldGFpbHMiLCJhc01vZGFsIiwiYWRkU3RhZmZWaXNpYmxlIiwic2hvd05ld1N0YWZmIiwicHJvZHVjdElkIiwic3RhZmYiLCJzZXJ2aWNlQ29udHJvbGxlciIsInBhcmFtcyIsInB1dCIsInBvc3QiLCJmYWN0b3J5IiwiZmlyc3RuYW1lIiwibGFzdG5hbWUiLCJtZW1iZXIiXSwibWFwcGluZ3MiOiJDQUNBLFdBQ0ksWUFFQSxJQUFJQSxHQUFTQyxRQUFRRCxPQUFPLE9BRXhCLFlBQ0EsaUJBQ0Esb0JBQ0EsZUFDQSxjQUNBLGVBQ0EsMkJBQ0EsVUFHSkEsR0FBT0UsUUFBUSxlQUFnQixTQUFVQyxHQUNyQ0YsUUFBUUcsT0FBT0QsR0FDWEUsY0FBZSxxQkFDZkMsYUFBYSxFQUNiQyxXQUFXLEVBQ1hDLGFBQWEsRUFDYkMsVUFBVywyQkFDWEMsZ0JBQWlCLElBQ2pCQyxhQUNJQyxNQUFPLGNBQ1BDLEtBQU0sYUFDTkMsUUFBUyxnQkFDVEMsUUFBUyxpQkFFYkMsYUFBYyxnQkFDZEMsU0FBVSxLQUNWQyxRQUFTLEtBQ1RDLE1BQU8sS0FDUEMsYUFBYSxFQUNiQyxjQUFjLEVBQ2RDLFdBQ0lDLE1BQU8sOEJBQ1BDLFlBQWEsMkNBRWpCQyxRQUFTLElBQ1RDLFdBQVksY0FDWkMsV0FBWTtDQ3pDeEIsV0FDcUIxQixRQUFRRCxPQUFPO0NDRHBDLFdBR0ksUUFBUzRCLEtBQ0wsR0FBSUMsR0FBUUMsSUFFWkQsR0FBTUUsUUFBVSxXQUNaQyxRQUFRQyxJQUFJLFFBQVNKLElBTjdCLEdBQUk3QixHQUFTQyxRQUFRRCxPQUFPLE1BVzVCQSxHQUFPa0MsVUFBVSxxQkFFVEMsWUFFQUMsU0FBVSxZQUNWUixZQUFhQTtDQ2pCekIsV0FJSSxRQUFTQSxHQUFXUyxFQUFPQyxHQUN2QixHQUFJVCxHQUFRQyxJQUVaRCxHQUFNRSxRQUFVLFdBQ1pNLEVBQU1FLElBQUksaUJBQWlCQyxLQUFLLFNBQVVDLEdBQ3RDWixFQUFNYSxXQUFh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U0FBVUMsR0FDbEQsR0FBSStGLEdBQU0zRyxFQUFNb0gsTUFBTVIsUUFBUWdCLEVBQzlCNUgsR0FBTW9ILE1BQU1QLE9BQU9GLEVBQUssS0FDekI1RixNQUFNLFNBQVVDLEdBQ2ZiLFFBQVFDLElBQUksUUFBU1ksRUFBSUMsYUFJckM2RixJQUNJUCxNQUFPLEtBQ1BDLE9BQVEsU0FBVW5FLEVBQU9vRSxVQS9DN0MsR0FBSXRJLEdBQVNDLFFBQVFELE9BQU8sTUF5RDVCQSxHQUFPa0MsVUFBVSxhQUVUQyxVQUNJOEcsTUFBTyxLQUVYdEYsWUFBYSxzQ0FDYi9CLFlBQWEsUUFBUyxZQUFhLGFBQWNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL2FwcC5tb2R1bGUuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcsXHJcbiAgICBbXHJcbiAgICAgICAgJ25nU3RvcmFnZScsXHJcbiAgICAgICAgJ2FwcC5kaXJlY3RpdmVzJyxcclxuICAgICAgICAnc2hhcmVkLmNvbXBvbmVudHMnLFxyXG4gICAgICAgICd1aS5ib290c3RyYXAnLFxyXG4gICAgICAgICdzbWFydC10YWJsZScsXHJcbiAgICAgICAgJ2NwLm5nQ29uZmlybScsIFxyXG4gICAgICAgICd0cmVhc3VyZS1vdmVybGF5LXNwaW5uZXInLCBcclxuICAgICAgICAndG9hc3RyJ1xyXG4gICAgICAgIF0pO1xyXG5cclxuICAgIG1vZHVsZS5jb25maWcoWyd0b2FzdHJDb25maWcnLCBmdW5jdGlvbiAodG9hc3RyQ29uZmlnKSB7XHJcbiAgICAgICAgYW5ndWxhci5leHRlbmQodG9hc3RyQ29uZmlnLCB7XHJcbiAgICAgICAgICAgIHBvc2l0aW9uQ2xhc3M6ICd0b2FzdC1ib3R0b20tcmlnaHQnLFxyXG4gICAgICAgICAgICBuZXdlc3RPblRvcDogdHJ1ZSxcclxuICAgICAgICAgICAgYWxsb3dIdG1sOiBmYWxzZSxcclxuICAgICAgICAgICAgY2xvc2VCdXR0b246IGZhbHNlLFxyXG4gICAgICAgICAgICBjbG9zZUh0bWw6ICc8YnV0dG9uPiZ0aW1lczs8L2J1dHRvbj4nLFxyXG4gICAgICAgICAgICBleHRlbmRlZFRpbWVPdXQ6IDEwMDAsXHJcbiAgICAgICAgICAgIGljb25DbGFzc2VzOiB7XHJcbiAgICAgICAgICAgICAgICBlcnJvcjogJ3RvYXN0LWVycm9yJyxcclxuICAgICAgICAgICAgICAgIGluZm86ICd0b2FzdC1pbmZvJyxcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ICd0b2FzdC1zdWNjZXNzJyxcclxuICAgICAgICAgICAgICAgIHdhcm5pbmc6ICd0b2FzdC13YXJuaW5nJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBtZXNzYWdlQ2xhc3M6ICd0b2FzdC1tZXNzYWdlJyxcclxuICAgICAgICAgICAgb25IaWRkZW46IG51bGwsXHJcbiAgICAgICAgICAgIG9uU2hvd246IG51bGwsXHJcbiAgICAgICAgICAgIG9uVGFwOiBudWxsLFxyXG4gICAgICAgICAgICBwcm9ncmVzc0JhcjogZmFsc2UsXHJcbiAgICAgICAgICAgIHRhcFRvRGlzbWlzczogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVzOiB7XHJcbiAgICAgICAgICAgICAgICB0b2FzdDogJ2RpcmVjdGl2ZXMvdG9hc3QvdG9hc3QuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBwcm9ncmVzc2JhcjogJ2RpcmVjdGl2ZXMvcHJvZ3Jlc3NiYXIvcHJvZ3Jlc3NiYXIuaHRtbCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGltZU91dDogNTAwMCxcclxuICAgICAgICAgICAgdGl0bGVDbGFzczogJ3RvYXN0LXRpdGxlJyxcclxuICAgICAgICAgICAgdG9hc3RDbGFzczogJ3RvYXN0J1xyXG4gICAgICAgIH0pO1xyXG4gICAgfV0pO1xyXG59KSgpOyIsIi8vc2hhcmVkLWNvbXBvbmVudHMubW9kdWxlLmpzXHJcbihmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ3NoYXJlZC5jb21wb25lbnRzJywgW10pO1xyXG4gICAgfVxyXG4pKCk7IiwiLy9jb25mcm1hdGlvbi1tb2RhbC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzOyBcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbW9kYWwnLCAkY3RybCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdjb25maXJtYXRpb25Nb2RhbCcsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJ3llcyBvciBubycsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFtjb250cm9sbGVyXVxyXG4gICAgICAgIH0pO1xyXG59XHJcbikoKTsiLCIvL3B1Ymxpc2hlci1saXN0LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnc2hhcmVkLmNvbXBvbmVudHMnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRodHRwLCAkdWliTW9kYWwpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkaHR0cC5nZXQoJ2FwaS9wdWJsaXNoZXInKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5wdWJsaXNoZXJzID0gci5kYXRhO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdwdWJsaXNoZXJFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbGcnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGNsb3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZXN1bHQgd2FzLT5cIik7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oJ3JldHVybmluZyByZXN1bHQnLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwucHVibGlzaGVycy51bnNoaWZ0KHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5pZCA9IHJlc3VsdC5pZDtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgZGltaXNzZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVhc29uIHdhcy0+XCIgKyByZWFzb24pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmVkaXQgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdwdWJsaXNoZXJFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICRjdHJsLmlkXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ2xnJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goJGN0cmwucHVibGlzaGVycywgZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gJGN0cmwuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoaXRlbSwgcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGN0cmwuaWQgPSBpdGVtLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgZGltaXNzZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVhc29uIHdhcy0+XCIgKyByZWFzb24pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgncHVibGlzaGVyU2VsZWN0JyxcclxuICAgIHtcclxuICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICBpZDogJz0nXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9jb21tb24vcHVibGlzaGVyLXNlbGVjdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsICckdWliTW9kYWwnLCBjb250cm9sbGVyXVxyXG4gICAgfSk7XHJcblxyXG5cclxufVxyXG4pKCk7IiwiLy9kaXJlY3RpdmVzLm1vZHVsZXMuanNcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJywgW10pOyBcclxufSkoKTsiLCIvL3N0VGFibGUuZGlyZWN0aXZlLmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycpO1xyXG5cclxuICAgIG1vZHVsZS5kaXJlY3RpdmUoJ3N0U3VibWl0U2VhcmNoJywgWydzdENvbmZpZycsICckdGltZW91dCcsICckcGFyc2UnLCBmdW5jdGlvbiAoc3RDb25maWcsICR0aW1lb3V0LCAkcGFyc2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1aXJlOiAnXnN0VGFibGUnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHIsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmJpbmQoJ2NsaWNrJyxcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZUN0cmwgPSBjdHJsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XHJcblxyXG4gICAgbW9kdWxlLmRpcmVjdGl2ZShcImNsZWFyS2V5XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsLCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgZWwub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggIT09IDI3KSB7IHJldHVybjsgfSAvLyBjaGVjayBrZXkgaG93IHlvdSB3YW50XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0Vmlld1ZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJHJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG5cclxuICAgIG1vZHVsZS5kaXJlY3RpdmUoXCJzdFJlc2V0U2VhcmNoXCIsXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZTogWydec3RUYWJsZScsICdebmdNb2RlbCddLFxyXG4gICAgICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmxzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmJpbmQoJ2NsaWNrJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSBjdHJsc1sxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IGN0cmxzWzBdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKG1vZGVsLiR2aWV3VmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkudG9Mb3dlckNhc2UoKSA9PT0gJ3BhZ2UnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLiR2aWV3VmFsdWVba2V5XSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSB8fCBfLmluY2x1ZGVzKGtleS50b0xvd2VyQ2FzZSgpLCAncGFnZScpKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuJHZpZXdWYWx1ZVtrZXldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVTdGF0ZSA9IGN0cmwudGFibGVTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVTdGF0ZS5wYWdpbmF0aW9uLnN0YXJ0ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgbW9kdWxlLmRpcmVjdGl2ZShcInN0Q2xlYXJLZXlcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgICAgICAgICByZXF1aXJlOiBbJ15zdFRhYmxlJywgJ15uZ01vZGVsJ10sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmxzKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5nTW9kZWwgPSBjdHJsc1sxXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IGN0cmxzWzBdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdHJsLnBpcGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSAyNykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuY29udGV4dC5hdHRyaWJ1dGVzWydzdC1zZWFyY2gnXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGROYW1lID0gZWxlbWVudC5jb250ZXh0LmF0dHJpYnV0ZXNbJ3N0LXNlYXJjaCddLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZVN0YXRlID0gY3RybC50YWJsZVN0YXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0W2ZpZWxkTmFtZV0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3RybC5waXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kcmVuZGVyKCk7IC8vIHdpbGwgdXBkYXRlIHRoZSBpbnB1dCB2YWx1ZSBhcyB3ZWxsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuXHJcbn1cclxuKSgpOyIsIi8vcHJvZHVjdC1lZGl0LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKHNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC50aXRsZSA9ICdOZXcgUHJvZHVjdCc7XHJcbiAgICAgICAgICAgIGlmICgkY3RybC5yZXNvbHZlKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5pZCA9ICRjdHJsLnJlc29sdmUuaWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCRjdHJsLmlkKSB7XHJcbiAgICAgICAgICAgICAgICBzZXJ2aWNlLmdldFByb2R1Y3QoJGN0cmwuaWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICAkY3RybC5wcm9kdWN0ID0gcjtcclxuICAgICAgICAgICAgICAgICAgICAkY3RybC50aXRsZSA9IHIudGl0bGU7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGN0cmwuZGlzbWlzcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuc2F2ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlcnZpY2Uuc2F2ZSgkY3RybC5wcm9kdWN0KS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCgkY3RybC5wcm9kdWN0LCByKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzYXZlIHByb2R1Y3QnLCAkY3RybC5wcm9kdWN0KTtcclxuICAgICAgICAgICAgICAgICRjdHJsLm1vZGFsSW5zdGFuY2UuY2xvc2UoJGN0cmwucHJvZHVjdCk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBzYXZpbmcgcHJvZHVjdCcsIGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgncHJvZHVjdEVkaXQnLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvcHJvZHVjdC9wcm9kdWN0LWVkaXQuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICc8JyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcclxuICAgICAgICAgICAgICAgIGNsb3NlOiAnJicsXHJcbiAgICAgICAgICAgICAgICBkaXNtaXNzOiAnJicsXHJcbiAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogWydQcm9kdWN0JywgY29udHJvbGxlcl1cclxuICAgICAgICB9KTtcclxufSkoKTtcclxuIiwiLy9wcm9kdWN0LWxpc3QuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRtb2RhbCwgJG5nQ29uZmlybSwgdG9hc3RyLCBwcm9kdWN0KSB7XHJcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcclxuICAgICAgICB2YXIgcGFnZVNpemVEZWZhdWx0ID0gMTA7XHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcblxyXG4gICAgICAgICRjdHJsLnNlYXJjaE1vZGVsID0ge1xyXG4gICAgICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgICAgICBwYWdlU2l6ZTogcGFnZVNpemVEZWZhdWx0LCBcclxuICAgICAgICAgICAgZmlsdGVyZWRDb3VudDogMCwgXHJcbiAgICAgICAgICAgIHRvdGFsQ291bnQ6IDAsIFxyXG4gICAgICAgICAgICB0b3RhbFBhZ2VzOiAwXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3Byb2R1Y3QgbGlzdCBpbml0Jyk7XHJcbiAgICAgICAgICAgICRjdHJsLnRpdGxlID0gJ01lZGlhIExpYnJhcnknO1xyXG4gICAgICAgICAgICAkY3RybC5sb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnNlYXJjaCA9IGZ1bmN0aW9uICh0YWJsZVN0YXRlKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB0YWJsZVN0YXRlUmVmID0gdGFibGVTdGF0ZTtcclxuICAgICAgICAgICAgcHJvZHVjdC5nZXRBbGxQcm9kdWN0cygkY3RybC5zZWFyY2hNb2RlbCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwucHJvZHVjdHMgPSByLnJlc3VsdHM7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5zZWFyY2hNb2RlbCA9IHI7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgJGN0cmwuc2VhcmNoTW9kZWwucmVzdWx0cztcclxuICAgICAgICAgICAgICAgICRjdHJsLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5wYWdlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGN0cmwuc2VhcmNoKHRhYmxlU3RhdGVSZWYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdwcm9kdWN0RWRpdCcsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ21kJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5wcm9kdWN0cy51bnNoaWZ0KHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICB0b2FzdHIuaW5mbygnQ3JlYXRlZCAnICsgcmVzdWx0LnRpdGxlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgZGltaXNzZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVhc29uIHdhcy0+XCIgKyByZWFzb24pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmVkaXQgPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdwcm9kdWN0RWRpdCcsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBpdGVtLmlkXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ21kJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChpdGVtLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgdG9hc3RyLmluZm8oJ1NhdmVkICcgKyByZXN1bHQudGl0bGUpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuZGVsZXRlID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgJG5nQ29uZmlybSh7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0RlbGV0ZScsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50OiAnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSA8YnIgLz48c3Ryb25nPicgKyBpdGVtLnRpdGxlICsgJzwvc3Ryb25nPj8nLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogJ3JlZCcsXHJcbiAgICAgICAgICAgICAgICBidXR0b25zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgeWVzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleXM6IFsneSddLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGZ1bmN0aW9uIChzY29wZSwgYnV0dG9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LnJlbW92ZShpdGVtLmlkKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9ICRjdHJsLnByb2R1Y3RzLmluZGV4T2YoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGN0cmwucHJvZHVjdHMuc3BsaWNlKGlkeCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLndhcm5pbmcoJ0RlbGV0ZWQgJyArIGl0ZW0udGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIG5vOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleXM6IFsnTiddLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGZ1bmN0aW9uIChzY29wZSwgYnV0dG9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuc2hvd0RldGFpbHMgPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdwcm9kdWN0U3VtbWFyeScsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBpdGVtLmlkLFxyXG4gICAgICAgICAgICAgICAgICAgIGFzTW9kYWw6IHRydWVcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGNsb3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZXN1bHQgd2FzLT5cIik7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChpdGVtLCByZXN1bHQpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBkaW1pc3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZWFzb24gd2FzLT5cIiArIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdwcm9kdWN0TGlzdCcsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9wcm9kdWN0L3Byb2R1Y3QtbGlzdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJHVpYk1vZGFsJywgJyRuZ0NvbmZpcm0nLCAndG9hc3RyJywgJ1Byb2R1Y3QnLCBjb250cm9sbGVyXVxyXG4gICAgICAgIH0pO1xyXG5cclxufVxyXG4pKCk7IiwiLy9wcm9kdWN0LXN1bW1hcnkuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJG1vZGFsLCBzZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGN0cmwubG9hZGluZyA9IHRydWU7IFxyXG4gICAgICAgICAgICBpZiAoJGN0cmwucmVzb2x2ZSkge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuaWQgPSAkY3RybC5yZXNvbHZlLmlkO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuYXNNb2RhbCA9ICRjdHJsLnJlc29sdmUuYXNNb2RhbDtcclxuICAgICAgICAgICAgICAgICRjdHJsLmFkZFN0YWZmVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLmdldFByb2R1Y3QoJGN0cmwuaWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnByb2R1Y3QgPSByO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwubG9hZGluZyA9IGZhbHNlOyBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5lZGl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ3Byb2R1Y3RFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICRjdHJsLnByb2R1Y3QuaWRcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKCRjdHJsLnByb2R1Y3QsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5zaG93TmV3U3RhZmYgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnc3RhZmZFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdElkOiAkY3RybC5pZFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgY2xvc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlc3VsdCB3YXMtPlwiKTtcclxuICAgICAgICAgICAgICAgICRjdHJsLnByb2R1Y3Quc3RhZmYudW5zaGlmdChyZXN1bHQpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBkaW1pc3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZWFzb24gd2FzLT5cIiArIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKCRjdHJsLnByb2R1Y3QpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgncHJvZHVjdFN1bW1hcnknLFxyXG4gICAge1xyXG4gICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgIGlkOiAnPCcsXHJcbiAgICAgICAgICAgIGFzTW9kYWw6ICc8JyxcclxuICAgICAgICAgICAgcmVzb2x2ZTogJzwnLFxyXG4gICAgICAgICAgICBjbG9zZTogJyYnLFxyXG4gICAgICAgICAgICBkaXNtaXNzOiAnJicsIFxyXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL3Byb2R1Y3QvcHJvZHVjdC1zdW1tYXJ5LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOiBbJyR1aWJNb2RhbCcsICdQcm9kdWN0JywgY29udHJvbGxlcl1cclxuICAgIH0pO1xyXG5cclxufVxyXG4pKCk7IiwiLy9wcm9kdWN0LnNlcnZpY2UuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7IFxyXG4gICAgXHJcbiAgICBtb2R1bGUuZmFjdG9yeSgnUHJvZHVjdCcsIFsnJGh0dHAnLCBzZXJ2aWNlQ29udHJvbGxlcl0pO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNlcnZpY2VDb250cm9sbGVyKCRodHRwKSB7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldFByb2R1Y3Q6IGdldFByb2R1Y3QsXHJcbiAgICAgICAgICAgIGdldEFsbFByb2R1Y3RzOiBnZXRBbGxQcm9kdWN0cyxcclxuICAgICAgICAgICAgcmVtb3ZlOiByZW1vdmUsIFxyXG4gICAgICAgICAgICBzYXZlOiBzYXZlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UHJvZHVjdChpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCdhcGkvcHJvZHVjdC8nICsgaWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByLmRhdGE7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBbGxQcm9kdWN0cyhzZWFyY2hNb2RlbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCdhcGkvcHJvZHVjdCcsIHsgcGFyYW1zOiBzZWFyY2hNb2RlbCB9KS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gci5kYXRhO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoJ2FwaS9wcm9kdWN0LycgKyBpZCkudGhlbihmdW5jdGlvbihyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gci5kYXRhO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7IFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2F2ZShwcm9kdWN0KSB7XHJcbiAgICAgICAgICAgIGlmIChwcm9kdWN0LmlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KCdhcGkvcHJvZHVjdCcsIHByb2R1Y3QpLnRoZW4oZnVuY3Rpb24ocikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCdhcGkvcHJvZHVjdCcsIHByb2R1Y3QpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gci5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnIubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbn1cclxuKSgpOyIsIi8vc3RhZmYtZWRpdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCkge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdGFmZiBlZGl0IGluaXQnKTtcclxuICAgICAgICAgICAgJGN0cmwudGl0bGUgPSAnTmV3IFN0YWZmJztcclxuXHJcbiAgICAgICAgICAgIGlmICgkY3RybC5yZXNvbHZlKSAkY3RybC5wcm9kdWN0SWQgPSAkY3RybC5yZXNvbHZlLnByb2R1Y3RJZDtcclxuXHJcbiAgICAgICAgICAgIGlmICgkY3RybC5yZXNvbHZlLnN0YWZmKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5zdGFmZiA9ICRjdHJsLnJlc29sdmUuc3RhZmY7XHJcbiAgICAgICAgICAgICAgICAkY3RybC50aXRsZSA9ICRjdHJsLnN0YWZmLmZpcnN0bmFtZSArICcgJyArICRjdHJsLnN0YWZmLmxhc3RuYW1lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkY3RybC5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoJGN0cmwucHJvZHVjdElkKSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCdhcGkvc3RhZmYvJyArICRjdHJsLnByb2R1Y3RJZCwgJGN0cmwuc3RhZmYpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCgkY3RybC5zdGFmZiwgci5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKHIuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NvbWV0aGluZyB3ZW50IHdyb25nJywgZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCdhcGkvc3RhZmYnLCAkY3RybC5zdGFmZikudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKCRjdHJsLnN0YWZmLCByLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICRjdHJsLm1vZGFsSW5zdGFuY2UuY2xvc2Uoci5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc29tZXRoaW5nIHdlbnQgd3JvbmcnLCBlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnc3RhZmZFZGl0JyxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiAnPCcsXHJcbiAgICAgICAgICAgICAgICBjbG9zZTogJyYnLFxyXG4gICAgICAgICAgICAgICAgZGlzbWlzczogJyYnLFxyXG4gICAgICAgICAgICAgICAgc3RhZmY6ICc8JyxcclxuICAgICAgICAgICAgICAgIHByb2R1Y3RJZDogJzwnLFxyXG4gICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogJzwnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL3N0YWZmL3N0YWZmLWVkaXQuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBbJyRodHRwJywgY29udHJvbGxlcl1cclxuICAgICAgICB9KTtcclxufVxyXG4pKCk7IiwiLy9zdGFmZi1saXN0LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRodHRwLCAkbW9kYWwsICRuZ0NvbmZpcm0pIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3RhZmYgbGlzdCBpbml0Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5lZGl0ID0gZnVuY3Rpb24gKG1lbWJlcikge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdzdGFmZkVkaXQnLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIixcclxuICAgICAgICAgICAgICAgICAgICBzdGFmZjogbWVtYmVyXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YWZmOiBtZW1iZXJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGNsb3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZXN1bHQgd2FzLT5cIik7XHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBkaW1pc3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZWFzb24gd2FzLT5cIiArIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuZGVsZXRlID0gZnVuY3Rpb24gKG1lbWJlcikge1xyXG4gICAgICAgICAgICAkbmdDb25maXJtKHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnRGVsZXRlJyxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIDxiciAvPjxzdHJvbmc+JyArIG1lbWJlci5maXJzdG5hbWUgKyBtZW1iZXIubGFzdG5hbWUgKyAnPC9zdHJvbmc+PycsXHJcbiAgICAgICAgICAgICAgICB0eXBlOiAncmVkJyxcclxuICAgICAgICAgICAgICAgIGJ1dHRvbnM6IHtcclxuICAgICAgICAgICAgICAgICAgICB5ZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAga2V5czogWyd5J10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogZnVuY3Rpb24gKHNjb3BlLCBidXR0b24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRodHRwLmRlbGV0ZSgnYXBpL3N0YWZmLycgKyBtZW1iZXIuaWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gJGN0cmwuc3RhZmYuaW5kZXhPZihtZW1iZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjdHJsLnN0YWZmLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicsIGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBubzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlzOiBbJ04nXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoc2NvcGUsIGJ1dHRvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdzdGFmZkxpc3QnLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgIHN0YWZmOiAnPCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvc3RhZmYvc3RhZmYtbGlzdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAnJHVpYk1vZGFsJywgJyRuZ0NvbmZpcm0nLCBjb250cm9sbGVyXVxyXG4gICAgICAgIH0pO1xyXG59XHJcbikoKTsiXX0=
