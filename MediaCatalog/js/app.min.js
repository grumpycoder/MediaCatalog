!function(){"use strict";var r=angular.module("app",["ngStorage","app.directives","shared.components","ui.bootstrap","smart-table","cp.ngConfirm"]).config(["$localStorageProvider","$httpProvider",function(r,e){r.setKeyPrefix("mc-"),e.interceptors.push("AuthenticationInterceptor")}]);r.factory("AuthenticationInterceptor",["$localStorage","$window",function(r,e){var t=this;return t.request=function(e){return e.headers=e.headers||{},r.currentUser&&(e.headers.Authorization="Bearer "+r.currentUser.token),e},t.responseError=function(r){return console.log("response error",r),401!==r.status&&403!==r.status||(e.location="/account/login"),$q.reject(r)},t}])}();
!function(){angular.module("shared.components",[])}();
!function(){function n(){var n=this;n.$onInit=function(){console.log("modal",n)}}var o=angular.module("app");o.component("confirmationModal",{bindings:{},template:"yes or no",controller:[n]})}();
!function(){function n(n,o){var e=this;e.$onInit=function(){n.get("api/publisher").then(function(n){e.publishers=n.data}).catch(function(n){console.log(n.message)})},e.create=function(){o.open({component:"publisherEdit",bindings:{modalInstance:"<"},size:"lg"}).result.then(function(n){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),console.info("returning result",n),e.publishers.unshift(n),e.id=n.id},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})},e.edit=function(){o.open({component:"publisherEdit",bindings:{modalInstance:"<"},resolve:{id:e.id},size:"lg"}).result.then(function(n){angular.forEach(e.publishers,function(o){o.id===e.id&&(angular.extend(o,n),e.id=o.id)})},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})}}var o=angular.module("shared.components");o.component("publisherSelect",{bindings:{id:"="},templateUrl:"app/common/publisher-select.component.html",controller:["$http","$uibModal",n]})}();
!function(){angular.module("app.directives",[])}();
!function(){var e=angular.module("app.directives");e.directive("stSubmitSearch",["stConfig","$timeout","$parse",function(e,t,r){return{require:"^stTable",link:function(e,t,r,n){return t.bind("click",function(){var e=n;e.pipe()})}}}]),e.directive("clearKey",function(){return{restrict:"EA",require:"ngModel",link:function(e,t,r,n){t.on("keydown",function(t){27===t.which&&(n.$setViewValue(null),n.$render(),e.$apply())})}}}),e.directive("stResetSearch",function(){return{restrict:"EA",require:["^stTable","^ngModel"],link:function(e,t,r,n){return t.bind("click",function(){var t=n[1],r=n[0];return e.$apply(function(){angular.forEach(t.$viewValue,function(e,r){"page"===r.toLowerCase()&&(t.$viewValue[r]=1),Array.isArray(e)||_.includes(r.toLowerCase(),"page")||(t.$viewValue[r]=null)});var e=r.tableState();return e.search.predicateObject={},e.pagination.start=0,r.pipe()})})}}}),e.directive("stClearKey",function(){return{restrict:"EA",require:["^stTable","^ngModel"],link:function(e,t,r,n){t.on("keydown",function(r){var i=n[1],a=n[0];return 13===r.which?a.pipe():27===r.which?void 0!==t.context.attributes["st-search"]?e.$apply(function(){var e=t.context.attributes["st-search"].value,r=a.tableState();return r.search.predicateObject[e]="",a.pipe()}):e.$apply(function(){i.$setViewValue(null),i.$render()}):void 0})}}})}();
!function(){function t(t){var n=this;n.$onInit=function(){n.title="New Product",n.resolve&&(n.id=n.resolve.id),n.id&&t.getProduct(n.id).then(function(t){n.product=t,n.title=t.title})},n.cancel=function(){n.dismiss()},n.save=function(){return t.save(n.product).then(function(t){angular.extend(n.product,t),n.modalInstance.close(n.product)}).catch(function(t){console.log("Error saving product",t.message)}).finally(function(){})}}var n=angular.module("app");n.component("productEdit",{templateUrl:"app/product/product-edit.component.html",bindings:{id:"<",resolve:"<",close:"&",dismiss:"&",modalInstance:"<"},controller:["Product",t]})}();
!function(){"use strict";function o(o,n,t,e){var s,c=this,i=10;c.searchModel={page:1,pageSize:i},c.$onInit=function(){console.log("product list init"),c.title="Product List",e.getToken()},c.search=function(o){s=o,console.log("search"),t.getAllProducts(c.searchModel).then(function(o){c.products=o.results,c.searchModel=o,delete c.searchModel.results})},c.paged=function(){c.search(s)},c.create=function(){o.open({component:"productEdit",bindings:{modalInstance:"<"},size:"md"}).result.then(function(o){c.products.unshift(o)},function(o){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+o)})},c.edit=function(n){o.open({component:"productEdit",bindings:{modalInstance:"<"},resolve:{id:n.id},size:"md"}).result.then(function(o){angular.extend(n,o)},function(o){})},c.delete=function(o){n({title:"Delete",content:"Are you sure you want to delete <br /><strong>"+o.title+"</strong>?",type:"red",buttons:{yes:{keys:["y"],action:function(n,e){t.remove(o.id).then(function(n){var t=c.products.indexOf(o);c.products.splice(t,1)})}},no:{keys:["N"],action:function(o,n){}}}})},c.showDetails=function(n){o.open({component:"productSummary",bindings:{modalInstance:"<"},resolve:{id:n.id,asModal:!0},size:"md"}).result.then(function(o){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),angular.extend(n,o)},function(o){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+o)})}}var n=angular.module("app");n.component("productList",{templateUrl:"app/product/product-list.component.html",controller:["$uibModal","$ngConfirm","Product","User",o]})}();
!function(){function o(o,n){var t=this;t.$onInit=function(){t.resolve&&(t.id=t.resolve.id,t.asModal=t.resolve.asModal,t.addStaffVisible=!1),n.getProduct(t.id).then(function(o){t.product=o})},t.edit=function(){o.open({component:"productEdit",bindings:{modalInstance:"<"},resolve:{id:t.product.id},size:"md"}).result.then(function(o){angular.extend(t.product,o)},function(o){})},t.showNewStaff=function(){o.open({component:"staffEdit",bindings:{modalInstance:"<"},resolve:{productId:t.id},size:"md"}).result.then(function(o){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),t.product.staff.unshift(o)},function(o){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+o)})},t.cancel=function(){t.modalInstance.close(t.product)}}var n=angular.module("app");n.component("productSummary",{bindings:{id:"<",asModal:"<",resolve:"<",close:"&",dismiss:"&",modalInstance:"<"},templateUrl:"app/product/product-summary.component.html",controller:["$uibModal","Product",o]})}();
!function(){function t(t,r){function e(){if(r.currentUser){var e=r.currentUser;t.post("api/auth/authenticate?user="+e.user+"&password="+e.password).then(function(t){e.token=t.data,r.currentUser=e}).catch(function(t){})}}return{getToken:e}}var r=angular.module("app");r.service("User",["$http","$localStorage",t])}();
!function(){"use strict";function t(t){function n(n){return t.get("api/product/"+n).then(function(t){return t.data}).catch(function(t){console.log(t.message)})}function e(n){return t.get("api/product",{params:n}).then(function(t){return t.data}).catch(function(t){console.log(t.message)})}function u(n){return t.delete("api/product/"+n).then(function(t){return t.data}).catch(function(t){console.log(t.message)})}function c(n){return n.id?t.put("api/product",n).then(function(t){return t.data}).catch(function(t){return t.message}):t.post("api/product",n).then(function(t){return t.data}).catch(function(t){return t.message})}return{getProduct:n,getAllProducts:e,remove:u,save:c}}var n=angular.module("app");n.factory("Product",["$http",t])}();
!function(){function t(t){var a=this;a.$onInit=function(){console.log("staff edit init"),a.title="New Staff",a.resolve&&(a.productId=a.resolve.productId),a.resolve.staff&&(a.staff=a.resolve.staff,a.title=a.staff.firstname+" "+a.staff.lastname)},a.cancel=function(){a.dismiss()},a.save=function(){a.productId?t.post("api/staff/"+a.productId,a.staff).then(function(t){angular.extend(a.staff,t.data),a.modalInstance.close(t.data)}).catch(function(t){console.log("something went wrong",t.message)}):t.post("api/staff",a.staff).then(function(t){angular.extend(a.staff,t.data),a.modalInstance.close(t.data)}).catch(function(t){console.log("something went wrong",t.message)})}}var a=angular.module("app");a.component("staffEdit",{bindings:{resolve:"<",close:"&",dismiss:"&",staff:"<",productId:"<",modalInstance:"<"},templateUrl:"app/staff/staff-edit.component.html",controller:["$http",t]})}();
!function(){function t(t,n,o){var e=this;e.$onInit=function(){console.log("staff list init")},e.edit=function(t){n.open({component:"staffEdit",bindings:{modalInstance:"<",staff:t},resolve:{staff:t},size:"md"}).result.then(function(t){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->")},function(t){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+t)})},e.delete=function(n){o({title:"Delete",content:"Are you sure you want to delete <br /><strong>"+n.firstname+n.lastname+"</strong>?",type:"red",buttons:{yes:{keys:["y"],action:function(o,s){t.delete("api/staff/"+n.id).then(function(t){var o=e.staff.indexOf(n);e.staff.splice(o,1)}).catch(function(t){console.log("error",t.message)})}},no:{keys:["N"],action:function(t,n){}}}})}}var n=angular.module("app");n.component("staffList",{bindings:{staff:"<"},templateUrl:"app/staff/staff-list.component.html",controller:["$http","$uibModal","$ngConfirm",t]})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJjb21tb24vY29tcG9uZW50cy5tb2R1bGUuanMiLCJjb21tb24vY29uZnJtYXRpb24tbW9kYWwuY29tcG9uZW50LmpzIiwiY29tbW9uL3B1Ymxpc2hlci1zZWxlY3QuY29tcG9uZW50LmpzIiwiZGlyZWN0aXZlcy9kaXJlY3RpdmVzLm1vZHVsZXMuanMiLCJkaXJlY3RpdmVzL3N0VGFibGUuZGlyZWN0aXZlLmpzIiwicHJvZHVjdC9wcm9kdWN0LWVkaXQuY29tcG9uZW50LmpzIiwicHJvZHVjdC9wcm9kdWN0LWxpc3QuY29tcG9uZW50LmpzIiwicHJvZHVjdC9wcm9kdWN0LXN1bW1hcnkuY29tcG9uZW50LmpzIiwic2VydmljZXMvYXV0aC5zZXJ2aWNlLmpzIiwic2VydmljZXMvcHJvZHVjdC5zZXJ2aWNlLmpzIiwic3RhZmYvc3RhZmYtZWRpdC5jb21wb25lbnQuanMiLCJzdGFmZi9zdGFmZi1saXN0LmNvbXBvbmVudC5qcyJdLCJuYW1lcyI6WyJtb2R1bGUiLCJhbmd1bGFyIiwiY29uZmlnIiwiJGxvY2FsU3RvcmFnZVByb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsInNldEtleVByZWZpeCIsImludGVyY2VwdG9ycyIsInB1c2giLCJmYWN0b3J5IiwiJGxvY2FsU3RvcmFnZSIsIiR3aW5kb3ciLCJzZXJ2aWNlIiwidGhpcyIsInJlcXVlc3QiLCJoZWFkZXJzIiwiY3VycmVudFVzZXIiLCJBdXRob3JpemF0aW9uIiwidG9rZW4iLCJyZXNwb25zZUVycm9yIiwicmVzcG9uc2UiLCJjb25zb2xlIiwibG9nIiwic3RhdHVzIiwibG9jYXRpb24iLCIkcSIsInJlamVjdCIsImNvbnRyb2xsZXIiLCIkY3RybCIsIiRvbkluaXQiLCJjb21wb25lbnQiLCJiaW5kaW5ncyIsInRlbXBsYXRlIiwiJGh0dHAiLCIkdWliTW9kYWwiLCJnZXQiLCJ0aGVuIiwiciIsInB1Ymxpc2hlcnMiLCJkYXRhIiwiY2F0Y2giLCJlcnIiLCJtZXNzYWdlIiwiY3JlYXRlIiwib3BlbiIsIm1vZGFsSW5zdGFuY2UiLCJzaXplIiwicmVzdWx0IiwiaW5mbyIsInVuc2hpZnQiLCJpZCIsInJlYXNvbiIsImVkaXQiLCJyZXNvbHZlIiwiZm9yRWFjaCIsIml0ZW0iLCJleHRlbmQiLCJ0ZW1wbGF0ZVVybCIsImRpcmVjdGl2ZSIsInN0Q29uZmlnIiwiJHRpbWVvdXQiLCIkcGFyc2UiLCJyZXF1aXJlIiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHIiLCJjdHJsIiwiYmluZCIsInRhYmxlQ3RybCIsInBpcGUiLCJyZXN0cmljdCIsImVsIiwiYXR0cnMiLCJvbiIsImV2ZW50Iiwid2hpY2giLCIkc2V0Vmlld1ZhbHVlIiwiJHJlbmRlciIsIiRhcHBseSIsImN0cmxzIiwibW9kZWwiLCIkdmlld1ZhbHVlIiwidmFsdWUiLCJrZXkiLCJ0b0xvd2VyQ2FzZSIsIkFycmF5IiwiaXNBcnJheSIsIl8iLCJpbmNsdWRlcyIsInRhYmxlU3RhdGUiLCJzZWFyY2giLCJwcmVkaWNhdGVPYmplY3QiLCJwYWdpbmF0aW9uIiwic3RhcnQiLCJuZ01vZGVsIiwidW5kZWZpbmVkIiwiY29udGV4dCIsImF0dHJpYnV0ZXMiLCJmaWVsZE5hbWUiLCJ0aXRsZSIsImdldFByb2R1Y3QiLCJwcm9kdWN0IiwiY2FuY2VsIiwiZGlzbWlzcyIsInNhdmUiLCJjbG9zZSIsImZpbmFsbHkiLCIkbW9kYWwiLCIkbmdDb25maXJtIiwidXNlciIsInRhYmxlU3RhdGVSZWYiLCJwYWdlU2l6ZURlZmF1bHQiLCJzZWFyY2hNb2RlbCIsInBhZ2UiLCJwYWdlU2l6ZSIsImdldFRva2VuIiwiZ2V0QWxsUHJvZHVjdHMiLCJwcm9kdWN0cyIsInJlc3VsdHMiLCJwYWdlZCIsImRlbGV0ZSIsImNvbnRlbnQiLCJ0eXBlIiwiYnV0dG9ucyIsInllcyIsImtleXMiLCJhY3Rpb24iLCJidXR0b24iLCJyZW1vdmUiLCJpZHgiLCJpbmRleE9mIiwic3BsaWNlIiwibm8iLCJzaG93RGV0YWlscyIsImFzTW9kYWwiLCJhZGRTdGFmZlZpc2libGUiLCJzaG93TmV3U3RhZmYiLCJwcm9kdWN0SWQiLCJzdGFmZiIsInBvc3QiLCJwYXNzd29yZCIsInNlcnZpY2VDb250cm9sbGVyIiwicGFyYW1zIiwicHV0IiwiZmlyc3RuYW1lIiwibGFzdG5hbWUiLCJtZW1iZXIiXSwibWFwcGluZ3MiOiJDQUNBLFdBQ0ksWUFFQSxJQUFJQSxHQUFTQyxRQUFRRCxPQUFPLE9BRXBCLFlBQ0EsaUJBQ0Esb0JBQ0EsZUFDQSxjQUNBLGlCQUNERSxRQUFRLHdCQUF5QixnQkFDaEMsU0FBVUMsRUFBdUJDLEdBQzdCRCxFQUFzQkUsYUFBYSxPQUNuQ0QsRUFBY0UsYUFBYUMsS0FBSywrQkFLNUNQLEdBQU9RLFFBQVEsNkJBQ1YsZ0JBQWlCLFVBQVcsU0FBVUMsRUFBZUMsR0FDbEQsR0FBSUMsR0FBVUMsSUFpQmQsT0FoQkFELEdBQVFFLFFBQVUsU0FBVVgsR0FLeEIsTUFKQUEsR0FBT1ksUUFBVVosRUFBT1ksWUFDcEJMLEVBQWNNLGNBQ2RiLEVBQU9ZLFFBQVFFLGNBQWdCLFVBQVlQLEVBQWNNLFlBQVlFLE9BRWxFZixHQUdYUyxFQUFRTyxjQUFnQixTQUFVQyxHQUs5QixNQUpBQyxTQUFRQyxJQUFJLGlCQUFrQkYsR0FDTixNQUFwQkEsRUFBU0csUUFBc0MsTUFBcEJILEVBQVNHLFNBQ3BDWixFQUFRYSxTQUFXLGtCQUVoQkMsR0FBR0MsT0FBT04sSUFHZFI7Q0N0Q25CLFdBQ3FCVixRQUFRRCxPQUFPO0NDRHBDLFdBR0ksUUFBUzBCLEtBQ0wsR0FBSUMsR0FBUWYsSUFFWmUsR0FBTUMsUUFBVSxXQUNaUixRQUFRQyxJQUFJLFFBQVNNLElBTjdCLEdBQUkzQixHQUFTQyxRQUFRRCxPQUFPLE1BVzVCQSxHQUFPNkIsVUFBVSxxQkFFVEMsWUFFQUMsU0FBVSxZQUNWTCxZQUFhQTtDQ2pCekIsV0FJSSxRQUFTQSxHQUFXTSxFQUFPQyxHQUN2QixHQUFJTixHQUFRZixJQUVaZSxHQUFNQyxRQUFVLFdBQ1pJLEVBQU1FLElBQUksaUJBQWlCQyxLQUFL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QVEsU0FBVS9ELEVBQU9nRSxHQUNyQi9GLEVBQU13RixPQUFPLGFBQWUwQixFQUFPakcsSUFBSWQsS0FBSyxTQUFVQyxHQUNsRCxHQUFJNkYsR0FBTXRHLEVBQU0rRyxNQUFNUixRQUFRZ0IsRUFDOUJ2SCxHQUFNK0csTUFBTVAsT0FBT0YsRUFBSyxLQUN6QjFGLE1BQU0sU0FBVUMsR0FDZnBCLFFBQVFDLElBQUksUUFBU21CLEVBQUlDLGFBSXJDMkYsSUFDSVAsTUFBTyxLQUNQQyxPQUFRLFNBQVUvRCxFQUFPZ0UsVUEvQzdDLEdBQUkvSCxHQUFTQyxRQUFRRCxPQUFPLE1BeUQ1QkEsR0FBTzZCLFVBQVUsYUFFVEMsVUFDSTRHLE1BQU8sS0FFWGxGLFlBQWEsc0NBQ2I5QixZQUFhLFFBQVMsWUFBYSxhQUFjQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9hcHAubW9kdWxlLmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLFxyXG4gICAgICAgIFtcclxuICAgICAgICAgICAgJ25nU3RvcmFnZScsXHJcbiAgICAgICAgICAgICdhcHAuZGlyZWN0aXZlcycsXHJcbiAgICAgICAgICAgICdzaGFyZWQuY29tcG9uZW50cycsXHJcbiAgICAgICAgICAgICd1aS5ib290c3RyYXAnLFxyXG4gICAgICAgICAgICAnc21hcnQtdGFibGUnLFxyXG4gICAgICAgICAgICAnY3AubmdDb25maXJtJ1xyXG4gICAgICAgIF0pLmNvbmZpZyhbJyRsb2NhbFN0b3JhZ2VQcm92aWRlcicsICckaHR0cFByb3ZpZGVyJyxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKCRsb2NhbFN0b3JhZ2VQcm92aWRlciwgJGh0dHBQcm92aWRlcikge1xyXG4gICAgICAgICAgICAgICAgJGxvY2FsU3RvcmFnZVByb3ZpZGVyLnNldEtleVByZWZpeCgnbWMtJyk7XHJcbiAgICAgICAgICAgICAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdBdXRoZW50aWNhdGlvbkludGVyY2VwdG9yJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdKTtcclxuXHJcblxyXG4gICAgbW9kdWxlLmZhY3RvcnkoJ0F1dGhlbnRpY2F0aW9uSW50ZXJjZXB0b3InLFxyXG4gICAgICAgIFsnJGxvY2FsU3RvcmFnZScsICckd2luZG93JywgZnVuY3Rpb24gKCRsb2NhbFN0b3JhZ2UsICR3aW5kb3cpIHtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2UgPSB0aGlzO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnJlcXVlc3QgPSBmdW5jdGlvbiAoY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVycyA9IGNvbmZpZy5oZWFkZXJzIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgaWYgKCRsb2NhbFN0b3JhZ2UuY3VycmVudFVzZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uID0gJ0JlYXJlciAnICsgJGxvY2FsU3RvcmFnZS5jdXJyZW50VXNlci50b2tlbjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBjb25maWc7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLnJlc3BvbnNlRXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXNwb25zZSBlcnJvcicsIHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSB8fCByZXNwb25zZS5zdGF0dXMgPT09IDQwMykge1xyXG4gICAgICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24gPSAnL2FjY291bnQvbG9naW4nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gc2VydmljZTtcclxuICAgICAgICB9XSk7XHJcblxyXG59KSgpOyIsIi8vc2hhcmVkLWNvbXBvbmVudHMubW9kdWxlLmpzXHJcbihmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ3NoYXJlZC5jb21wb25lbnRzJywgW10pO1xyXG4gICAgfVxyXG4pKCk7IiwiLy9jb25mcm1hdGlvbi1tb2RhbC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzOyBcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbW9kYWwnLCAkY3RybCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdjb25maXJtYXRpb25Nb2RhbCcsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJ3llcyBvciBubycsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFtjb250cm9sbGVyXVxyXG4gICAgICAgIH0pO1xyXG59XHJcbikoKTsiLCIvL3B1Ymxpc2hlci1saXN0LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnc2hhcmVkLmNvbXBvbmVudHMnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRodHRwLCAkdWliTW9kYWwpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkaHR0cC5nZXQoJ2FwaS9wdWJsaXNoZXInKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5wdWJsaXNoZXJzID0gci5kYXRhO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdwdWJsaXNoZXJFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbGcnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGNsb3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZXN1bHQgd2FzLT5cIik7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oJ3JldHVybmluZyByZXN1bHQnLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwucHVibGlzaGVycy51bnNoaWZ0KHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5pZCA9IHJlc3VsdC5pZDtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgZGltaXNzZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVhc29uIHdhcy0+XCIgKyByZWFzb24pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmVkaXQgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdwdWJsaXNoZXJFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICRjdHJsLmlkXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ2xnJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goJGN0cmwucHVibGlzaGVycywgZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gJGN0cmwuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoaXRlbSwgcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGN0cmwuaWQgPSBpdGVtLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgZGltaXNzZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVhc29uIHdhcy0+XCIgKyByZWFzb24pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgncHVibGlzaGVyU2VsZWN0JyxcclxuICAgIHtcclxuICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICBpZDogJz0nXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9jb21tb24vcHVibGlzaGVyLXNlbGVjdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsICckdWliTW9kYWwnLCBjb250cm9sbGVyXVxyXG4gICAgfSk7XHJcblxyXG5cclxufVxyXG4pKCk7IiwiLy9kaXJlY3RpdmVzLm1vZHVsZXMuanNcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJywgW10pOyBcclxufSkoKTsiLCIvL3N0VGFibGUuZGlyZWN0aXZlLmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycpO1xyXG5cclxuICAgIG1vZHVsZS5kaXJlY3RpdmUoJ3N0U3VibWl0U2VhcmNoJywgWydzdENvbmZpZycsICckdGltZW91dCcsICckcGFyc2UnLCBmdW5jdGlvbiAoc3RDb25maWcsICR0aW1lb3V0LCAkcGFyc2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1aXJlOiAnXnN0VGFibGUnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHIsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmJpbmQoJ2NsaWNrJyxcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZUN0cmwgPSBjdHJsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XHJcblxyXG4gICAgbW9kdWxlLmRpcmVjdGl2ZShcImNsZWFyS2V5XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsLCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgZWwub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggIT09IDI3KSB7IHJldHVybjsgfSAvLyBjaGVjayBrZXkgaG93IHlvdSB3YW50XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0Vmlld1ZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJHJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG5cclxuICAgIG1vZHVsZS5kaXJlY3RpdmUoXCJzdFJlc2V0U2VhcmNoXCIsXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZTogWydec3RUYWJsZScsICdebmdNb2RlbCddLFxyXG4gICAgICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmxzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmJpbmQoJ2NsaWNrJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSBjdHJsc1sxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IGN0cmxzWzBdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKG1vZGVsLiR2aWV3VmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkudG9Mb3dlckNhc2UoKSA9PT0gJ3BhZ2UnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLiR2aWV3VmFsdWVba2V5XSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSB8fCBfLmluY2x1ZGVzKGtleS50b0xvd2VyQ2FzZSgpLCAncGFnZScpKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuJHZpZXdWYWx1ZVtrZXldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVTdGF0ZSA9IGN0cmwudGFibGVTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVTdGF0ZS5wYWdpbmF0aW9uLnN0YXJ0ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgbW9kdWxlLmRpcmVjdGl2ZShcInN0Q2xlYXJLZXlcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgICAgICAgICByZXF1aXJlOiBbJ15zdFRhYmxlJywgJ15uZ01vZGVsJ10sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmxzKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5nTW9kZWwgPSBjdHJsc1sxXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IGN0cmxzWzBdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdHJsLnBpcGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSAyNykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuY29udGV4dC5hdHRyaWJ1dGVzWydzdC1zZWFyY2gnXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGROYW1lID0gZWxlbWVudC5jb250ZXh0LmF0dHJpYnV0ZXNbJ3N0LXNlYXJjaCddLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZVN0YXRlID0gY3RybC50YWJsZVN0YXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0W2ZpZWxkTmFtZV0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3RybC5waXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kcmVuZGVyKCk7IC8vIHdpbGwgdXBkYXRlIHRoZSBpbnB1dCB2YWx1ZSBhcyB3ZWxsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuXHJcbn1cclxuKSgpOyIsIi8vcHJvZHVjdC1lZGl0LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKHNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC50aXRsZSA9ICdOZXcgUHJvZHVjdCc7IFxyXG4gICAgICAgICAgICBpZiAoJGN0cmwucmVzb2x2ZSkge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuaWQgPSAkY3RybC5yZXNvbHZlLmlkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICgkY3RybC5pZCkge1xyXG4gICAgICAgICAgICAgICAgc2VydmljZS5nZXRQcm9kdWN0KCRjdHJsLmlkKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwucHJvZHVjdCA9IHI7XHJcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwudGl0bGUgPSByLnRpdGxlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlLnNhdmUoJGN0cmwucHJvZHVjdCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoJGN0cmwucHJvZHVjdCwgcik7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKCRjdHJsLnByb2R1Y3QpO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3Igc2F2aW5nIHByb2R1Y3QnLCBlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ3Byb2R1Y3RFZGl0JyxcclxuICAgIHtcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9wcm9kdWN0L3Byb2R1Y3QtZWRpdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgaWQ6ICc8JyxcclxuICAgICAgICAgICAgcmVzb2x2ZTogJzwnLFxyXG4gICAgICAgICAgICBjbG9zZTogJyYnLFxyXG4gICAgICAgICAgICBkaXNtaXNzOiAnJicsXHJcbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6ICc8J1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29udHJvbGxlcjogWydQcm9kdWN0JywgY29udHJvbGxlcl1cclxuICAgIH0pO1xyXG59KSgpO1xyXG4gICAgIiwiLy9wcm9kdWN0LWxpc3QuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRtb2RhbCwgJG5nQ29uZmlybSwgcHJvZHVjdCwgdXNlcikge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHBhZ2VTaXplRGVmYXVsdCA9IDEwO1xyXG4gICAgICAgIHZhciB0YWJsZVN0YXRlUmVmO1xyXG5cclxuICAgICAgICAkY3RybC5zZWFyY2hNb2RlbCA9IHtcclxuICAgICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplRGVmYXVsdFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwcm9kdWN0IGxpc3QgaW5pdCcpO1xyXG4gICAgICAgICAgICAkY3RybC50aXRsZSA9ICdQcm9kdWN0IExpc3QnO1xyXG4gICAgICAgICAgICB1c2VyLmdldFRva2VuKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5zZWFyY2ggPSBmdW5jdGlvbiAodGFibGVTdGF0ZSkge1xyXG4gICAgICAgICAgICB0YWJsZVN0YXRlUmVmID0gdGFibGVTdGF0ZTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlYXJjaCcpO1xyXG4gICAgICAgICAgICBwcm9kdWN0LmdldEFsbFByb2R1Y3RzKCRjdHJsLnNlYXJjaE1vZGVsKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5wcm9kdWN0cyA9IHIucmVzdWx0cztcclxuICAgICAgICAgICAgICAgICRjdHJsLnNlYXJjaE1vZGVsID0gcjtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSAkY3RybC5zZWFyY2hNb2RlbC5yZXN1bHRzO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnBhZ2VkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC5zZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ3Byb2R1Y3RFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnByb2R1Y3RzLnVuc2hpZnQocmVzdWx0KTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgZGltaXNzZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVhc29uIHdhcy0+XCIgKyByZWFzb24pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmVkaXQgPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdwcm9kdWN0RWRpdCcsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBpdGVtLmlkXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ21kJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChpdGVtLCByZXN1bHQpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuZGVsZXRlID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgJG5nQ29uZmlybSh7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0RlbGV0ZScsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50OiAnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSA8YnIgLz48c3Ryb25nPicgKyBpdGVtLnRpdGxlICsgJzwvc3Ryb25nPj8nLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogJ3JlZCcsXHJcbiAgICAgICAgICAgICAgICBidXR0b25zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgeWVzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleXM6IFsneSddLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGZ1bmN0aW9uIChzY29wZSwgYnV0dG9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LnJlbW92ZShpdGVtLmlkKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9ICRjdHJsLnByb2R1Y3RzLmluZGV4T2YoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGN0cmwucHJvZHVjdHMuc3BsaWNlKGlkeCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgbm86IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAga2V5czogWydOJ10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogZnVuY3Rpb24gKHNjb3BlLCBidXR0b24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5zaG93RGV0YWlscyA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ3Byb2R1Y3RTdW1tYXJ5JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGl0ZW0uaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgYXNNb2RhbDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgY2xvc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlc3VsdCB3YXMtPlwiKTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGl0ZW0sIHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGRpbWlzc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlYXNvbiB3YXMtPlwiICsgcmVhc29uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ3Byb2R1Y3RMaXN0JyxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL3Byb2R1Y3QvcHJvZHVjdC1saXN0LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogWyckdWliTW9kYWwnLCAnJG5nQ29uZmlybScsICdQcm9kdWN0JywgJ1VzZXInLCBjb250cm9sbGVyXVxyXG4gICAgICAgIH0pO1xyXG5cclxufVxyXG4pKCk7IiwiLy9wcm9kdWN0LXN1bW1hcnkuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJG1vZGFsLCBzZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlkID0gJGN0cmwucmVzb2x2ZS5pZDtcclxuICAgICAgICAgICAgICAgICRjdHJsLmFzTW9kYWwgPSAkY3RybC5yZXNvbHZlLmFzTW9kYWw7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5hZGRTdGFmZlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2VydmljZS5nZXRQcm9kdWN0KCRjdHJsLmlkKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5wcm9kdWN0ID0gcjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5lZGl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ3Byb2R1Y3RFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICRjdHJsLnByb2R1Y3QuaWRcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKCRjdHJsLnByb2R1Y3QsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5zaG93TmV3U3RhZmYgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnc3RhZmZFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdElkOiAkY3RybC5pZFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgY2xvc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlc3VsdCB3YXMtPlwiKTtcclxuICAgICAgICAgICAgICAgICRjdHJsLnByb2R1Y3Quc3RhZmYudW5zaGlmdChyZXN1bHQpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBkaW1pc3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZWFzb24gd2FzLT5cIiArIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKCRjdHJsLnByb2R1Y3QpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgncHJvZHVjdFN1bW1hcnknLFxyXG4gICAge1xyXG4gICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgIGlkOiAnPCcsXHJcbiAgICAgICAgICAgIGFzTW9kYWw6ICc8JyxcclxuICAgICAgICAgICAgcmVzb2x2ZTogJzwnLFxyXG4gICAgICAgICAgICBjbG9zZTogJyYnLFxyXG4gICAgICAgICAgICBkaXNtaXNzOiAnJicsIFxyXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL3Byb2R1Y3QvcHJvZHVjdC1zdW1tYXJ5LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOiBbJyR1aWJNb2RhbCcsICdQcm9kdWN0JywgY29udHJvbGxlcl1cclxuICAgIH0pO1xyXG5cclxufVxyXG4pKCk7IiwiLy9hdXRoLnNlcnZpY2UuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gc2VydmljZSgkaHR0cCwgJGxvY2FsU3RvcmFnZSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldFRva2VuOiBnZXRUb2tlblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VG9rZW4oKSB7XHJcbiAgICAgICAgICAgIGlmICgkbG9jYWxTdG9yYWdlLmN1cnJlbnRVc2VyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudFVzZXIgPSAkbG9jYWxTdG9yYWdlLmN1cnJlbnRVc2VyO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnYXBpL2F1dGgvYXV0aGVudGljYXRlP3VzZXI9JyArXHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFVzZXIudXNlciArXHJcbiAgICAgICAgICAgICAgICAgICAgJyZwYXNzd29yZD0nICtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50VXNlci5wYXNzd29yZCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VXNlci50b2tlbiA9IHIuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2FsU3RvcmFnZS5jdXJyZW50VXNlciA9IGN1cnJlbnRVc2VyO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuc2VydmljZSgnVXNlcicsIFsnJGh0dHAnLCAnJGxvY2FsU3RvcmFnZScsIHNlcnZpY2VdKTtcclxufVxyXG4pKCk7IiwiLy9wcm9kdWN0LnNlcnZpY2UuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7IFxyXG4gICAgXHJcbiAgICBtb2R1bGUuZmFjdG9yeSgnUHJvZHVjdCcsIFsnJGh0dHAnLCBzZXJ2aWNlQ29udHJvbGxlcl0pO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNlcnZpY2VDb250cm9sbGVyKCRodHRwKSB7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldFByb2R1Y3Q6IGdldFByb2R1Y3QsXHJcbiAgICAgICAgICAgIGdldEFsbFByb2R1Y3RzOiBnZXRBbGxQcm9kdWN0cyxcclxuICAgICAgICAgICAgcmVtb3ZlOiByZW1vdmUsIFxyXG4gICAgICAgICAgICBzYXZlOiBzYXZlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UHJvZHVjdChpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCdhcGkvcHJvZHVjdC8nICsgaWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByLmRhdGE7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBbGxQcm9kdWN0cyhzZWFyY2hNb2RlbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCdhcGkvcHJvZHVjdCcsIHsgcGFyYW1zOiBzZWFyY2hNb2RlbCB9KS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gci5kYXRhO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoJ2FwaS9wcm9kdWN0LycgKyBpZCkudGhlbihmdW5jdGlvbihyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gci5kYXRhO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7IFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2F2ZShwcm9kdWN0KSB7XHJcbiAgICAgICAgICAgIGlmIChwcm9kdWN0LmlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KCdhcGkvcHJvZHVjdCcsIHByb2R1Y3QpLnRoZW4oZnVuY3Rpb24ocikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCdhcGkvcHJvZHVjdCcsIHByb2R1Y3QpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gci5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnIubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbn1cclxuKSgpOyIsIi8vc3RhZmYtZWRpdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCkge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdGFmZiBlZGl0IGluaXQnKTtcclxuICAgICAgICAgICAgJGN0cmwudGl0bGUgPSAnTmV3IFN0YWZmJztcclxuXHJcbiAgICAgICAgICAgIGlmICgkY3RybC5yZXNvbHZlKSAkY3RybC5wcm9kdWN0SWQgPSAkY3RybC5yZXNvbHZlLnByb2R1Y3RJZDtcclxuXHJcbiAgICAgICAgICAgIGlmICgkY3RybC5yZXNvbHZlLnN0YWZmKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5zdGFmZiA9ICRjdHJsLnJlc29sdmUuc3RhZmY7XHJcbiAgICAgICAgICAgICAgICAkY3RybC50aXRsZSA9ICRjdHJsLnN0YWZmLmZpcnN0bmFtZSArICcgJyArICRjdHJsLnN0YWZmLmxhc3RuYW1lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkY3RybC5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoJGN0cmwucHJvZHVjdElkKSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCdhcGkvc3RhZmYvJyArICRjdHJsLnByb2R1Y3RJZCwgJGN0cmwuc3RhZmYpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCgkY3RybC5zdGFmZiwgci5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKHIuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NvbWV0aGluZyB3ZW50IHdyb25nJywgZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCdhcGkvc3RhZmYnLCAkY3RybC5zdGFmZikudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKCRjdHJsLnN0YWZmLCByLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICRjdHJsLm1vZGFsSW5zdGFuY2UuY2xvc2Uoci5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc29tZXRoaW5nIHdlbnQgd3JvbmcnLCBlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnc3RhZmZFZGl0JyxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiAnPCcsXHJcbiAgICAgICAgICAgICAgICBjbG9zZTogJyYnLFxyXG4gICAgICAgICAgICAgICAgZGlzbWlzczogJyYnLFxyXG4gICAgICAgICAgICAgICAgc3RhZmY6ICc8JyxcclxuICAgICAgICAgICAgICAgIHByb2R1Y3RJZDogJzwnLFxyXG4gICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogJzwnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL3N0YWZmL3N0YWZmLWVkaXQuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBbJyRodHRwJywgY29udHJvbGxlcl1cclxuICAgICAgICB9KTtcclxufVxyXG4pKCk7IiwiLy9zdGFmZi1saXN0LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRodHRwLCAkbW9kYWwsICRuZ0NvbmZpcm0pIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3RhZmYgbGlzdCBpbml0Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5lZGl0ID0gZnVuY3Rpb24gKG1lbWJlcikge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdzdGFmZkVkaXQnLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIixcclxuICAgICAgICAgICAgICAgICAgICBzdGFmZjogbWVtYmVyXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YWZmOiBtZW1iZXJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGNsb3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZXN1bHQgd2FzLT5cIik7XHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBkaW1pc3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZWFzb24gd2FzLT5cIiArIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuZGVsZXRlID0gZnVuY3Rpb24gKG1lbWJlcikge1xyXG4gICAgICAgICAgICAkbmdDb25maXJtKHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnRGVsZXRlJyxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIDxiciAvPjxzdHJvbmc+JyArIG1lbWJlci5maXJzdG5hbWUgKyBtZW1iZXIubGFzdG5hbWUgKyAnPC9zdHJvbmc+PycsXHJcbiAgICAgICAgICAgICAgICB0eXBlOiAncmVkJyxcclxuICAgICAgICAgICAgICAgIGJ1dHRvbnM6IHtcclxuICAgICAgICAgICAgICAgICAgICB5ZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAga2V5czogWyd5J10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogZnVuY3Rpb24gKHNjb3BlLCBidXR0b24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRodHRwLmRlbGV0ZSgnYXBpL3N0YWZmLycgKyBtZW1iZXIuaWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gJGN0cmwuc3RhZmYuaW5kZXhPZihtZW1iZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjdHJsLnN0YWZmLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicsIGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBubzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlzOiBbJ04nXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoc2NvcGUsIGJ1dHRvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdzdGFmZkxpc3QnLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgIHN0YWZmOiAnPCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvc3RhZmYvc3RhZmYtbGlzdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAnJHVpYk1vZGFsJywgJyRuZ0NvbmZpcm0nLCBjb250cm9sbGVyXVxyXG4gICAgICAgIH0pO1xyXG59XHJcbikoKTsiXX0=
