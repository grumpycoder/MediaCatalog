!function(){angular.module("app.services",[])}(),function(){"use strict";function n(n){function e(e){return n.get("api/product/"+e).then(function(n){return n.data}).catch(function(n){console.log(n.message)})}function o(e){return n.get("api/product",{params:e}).then(function(n){return n.data}).catch(function(n){console.log(n.message)})}function t(e){return e.id?n.put("api/product",e).then(function(n){return n.data}).catch(function(n){return n.message}):n.post("api/product",e).then(function(n){return n.data}).catch(function(n){return n.message})}return{getMedia:e,getAllMedia:o,save:t}}n.$inject=["$http"];angular.module("app.services").factory("ProductService",n)}(),function(){"use strict";var n=angular.module("app",["app.services","app.directives","shared.components","ngComponentRouter","ui.bootstrap","smart-table"]);n.component("libraryApp",{templateUrl:"/app/product-app.component.html",$routeConfig:[{path:"/",name:"List",component:"list",useAsDefault:!0}]}),n.value("$routerRootComponent","libraryApp")}(),function(){function n(n){var e=this;e.$onInit=function(){e.resolve&&(e.id=e.resolve.id),e.id&&n.get("api/publisher/"+e.id).then(function(n){e.publisher=n.data}).catch(function(n){console.log("Error retriving publisher",n.message)}).finally(function(){}),console.log("$ctrl",e)},e.cancel=function(){e.dismiss()},e.save=function(){return n.post("api/publisher",e.publisher).then(function(n){angular.extend(e.publisher,n.data)}).catch(function(n){console.log("Error saving publisher",n.message)}).finally(function(){console.log("edit publisher",e.publisher),e.modalInstance.close(e.publisher)})}}var e=angular.module("app");e.component("publisherEdit",{bindings:{id:"<",resolve:"<",close:"&",dismiss:"&",modalInstance:"<"},templateUrl:"app/publisher/publisher-edit.component.html",controller:["$http",n]})}(),function(){function n(n){var e=this;e.$onInit=function(){console.log("summary active"),e.resolve&&(e.id=e.resolve.id,e.asModal=e.resolve.asModal,e.addStaffVisible=!1),n.getMedia(e.id).then(function(n){e.media=n})},e.createStaff=function(){console.log("add staff modal")},e.cancel=function(){e.dismiss()}}var e=angular.module("app");e.component("mediaSummary",{bindings:{id:"<",asModal:"<",resolve:"<",close:"&",dismiss:"&"},templateUrl:"app/product/product-summary.component.html",controller:["ProductService",n]})}(),function(){"use strict";function n(n,e){var o,t=this,i=10;t.searchModel={page:1,pageSize:i},t.$onInit=function(){},t.search=function(n){o=n,e.getAllMedia(t.searchModel).then(function(n){t.media=n.results,t.searchModel=n,delete t.searchModel.results})},t.paged=function(){t.search(o)},t.edit=function(e){n.open({component:"mediaEdit",bindings:{modalInstance:"<"},resolve:{id:e.id},size:"lg"}).result.then(function(n){angular.extend(e,n)},function(n){})},t.create=function(){n.open({component:"mediaEdit",bindings:{modalInstance:"<"},size:"lg"}).result.then(function(n){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),console.info("returning result",n),t.media.unshift(n)},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})},t.showDetails=function(e){n.open({component:"mediaSummary",bindings:{modalInstance:"<"},resolve:{id:e,asModal:!0},size:"lg"}).result.then(function(n){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),console.info(n)},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})}}var e=angular.module("app");e.component("list",{templateUrl:"app/product/product-list.component.html",controller:["$uibModal","ProductService",n]})}(),function(){function n(n){var e=this;e.$onInit=function(){e.resolve&&(e.id=e.resolve.id),e.id&&n.getMedia(e.id).then(function(n){e.media=n})},e.cancel=function(){e.dismiss()},e.save=function(){return n.save(e.media).then(function(n){angular.extend(e.media,n)}).catch(function(n){console.log("Error saving product",n.message)}).finally(function(){e.modalInstance.close(e.media)})}}var e=angular.module("app");e.component("mediaEdit",{templateUrl:"app/product/product-edit.component.html",bindings:{id:"<",resolve:"<",close:"&",dismiss:"&",modalInstance:"<"},controller:["ProductService",n]})}(),function(){angular.module("app.directives",[]).directive("stSubmitSearch",["stConfig","$timeout","$parse",function(n,e,o){return{require:"^stTable",link:function(n,e,o,t){return e.bind("click",function(){var n=t;n.pipe()})}}}])}(),function(){angular.module("shared.components",[])}(),function(){function n(n,e){var o=this;o.$onInit=function(){n.get("api/publisher").then(function(n){o.publishers=n.data}).catch(function(n){console.log(n.message)})},o.create=function(){e.open({component:"publisherEdit",bindings:{modalInstance:"<"},size:"lg"}).result.then(function(n){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),console.info("returning result",n),o.publishers.unshift(n),o.id=n.id},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})},o.edit=function(){e.open({component:"publisherEdit",bindings:{modalInstance:"<"},resolve:{id:o.id},size:"lg"}).result.then(function(n){angular.forEach(o.publishers,function(e){e.id===o.id&&(angular.extend(e,n),o.id=e.id)})},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})}}var e=angular.module("shared.components");e.component("publisherList",{bindings:{id:"="},templateUrl:"app/common/publisher-list.component.html",controller:["$http","$uibModal",n]})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VzL3NlcnZpY2VzLm1vZHVsZS5qcyIsInNlcnZpY2VzL3Byb2R1Y3Quc2VydmljZS5qcyIsInByb2R1Y3QtYXBwLm1vZHVsZS5qcyIsInB1Ymxpc2hlci9wdWJsaXNoZXItZWRpdC5jb21wb25lbnQuanMiLCJwcm9kdWN0L3Byb2R1Y3Qtc3VtbWFyeS5jb21wb25lbnQuanMiLCJwcm9kdWN0L3Byb2R1Y3QtbGlzdC5jb21wb25lbnQuanMiLCJwcm9kdWN0L3Byb2R1Y3QtZWRpdC5jb21wb25lbnQuanMiLCJkaXJlY3RpdmVzL2RpcmVjdGl2ZXMubW9kdWxlcy5qcyIsImNvbW1vbi9jb21wb25lbnRzLm1vZHVsZS5qcyIsImNvbW1vbi9wdWJsaXNoZXItbGlzdC5jb21wb25lbnQuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsIm1lZGlhU2VydmljZSIsIiRodHRwIiwiZ2V0TWVkaWEiLCJpZCIsImdldCIsInRoZW4iLCJyIiwiZGF0YSIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsIm1lc3NhZ2UiLCJnZXRBbGxNZWRpYSIsInNlYXJjaE1vZGVsIiwicGFyYW1zIiwic2F2ZSIsIm1lZGlhIiwicHV0IiwicG9zdCIsImZhY3RvcnkiLCJjb21wb25lbnQiLCJ0ZW1wbGF0ZVVybCIsIiRyb3V0ZUNvbmZpZyIsInBhdGgiLCJuYW1lIiwidXNlQXNEZWZhdWx0IiwidmFsdWUiLCJjb250cm9sbGVyIiwiJGN0cmwiLCJ0aGlzIiwiJG9uSW5pdCIsInJlc29sdmUiLCJwdWJsaXNoZXIiLCJmaW5hbGx5IiwiY2FuY2VsIiwiZGlzbWlzcyIsImV4dGVuZCIsIm1vZGFsSW5zdGFuY2UiLCJjbG9zZSIsImJpbmRpbmdzIiwic2VydmljZSIsImFzTW9kYWwiLCJhZGRTdGFmZlZpc2libGUiLCJjcmVhdGVTdGFmZiIsIiR1aWJNb2RhbCIsInRhYmxlU3RhdGVSZWYiLCJwYWdlU2l6ZURlZmF1bHQiLCJwYWdlIiwicGFnZVNpemUiLCJzZWFyY2giLCJ0YWJsZVN0YXRlIiwicmVzdWx0cyIsInBhZ2VkIiwiZWRpdCIsIml0ZW0iLCJvcGVuIiwic2l6ZSIsInJlc3VsdCIsInJlYXNvbiIsImNyZWF0ZSIsImluZm8iLCJ1bnNoaWZ0Iiwic2hvd0RldGFpbHMiLCJkaXJlY3RpdmUiLCJzdENvbmZpZyIsIiR0aW1lb3V0IiwiJHBhcnNlIiwicmVxdWlyZSIsImxpbmsiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRyIiwiY3RybCIsImJpbmQiLCJ0YWJsZUN0cmwiLCJwaXBlIiwicHVibGlzaGVycyIsImZvckVhY2giXSwibWFwcGluZ3MiOiJDQUNBLFdBQ3FCQSxRQUFRQyxPQUFPLHNCQ0RwQyxXQUNJLFlBR0EsU0FBU0MsR0FBYUMsR0FRbEIsUUFBU0MsR0FBU0MsR0FDZCxNQUFPRixHQUFNRyxJQUFJLGVBQWlCRCxHQUFJRSxLQUFLLFNBQVVDLEdBQ2pELE1BQU9BLEdBQUVDLE9BQ1ZDLE1BQU0sU0FBVUMsR0FDZkMsUUFBUUMsSUFBSUYsRUFBSUcsV0FJeEIsUUFBU0MsR0FBWUMsR0FDakIsTUFBT2IsR0FBTUcsSUFBSSxlQUFpQlcsT0FBUUQsSUFBZVQsS0FBSyxTQUFVQyxHQUNwRSxNQUFPQSxHQUFFQyxPQUNWQyxNQUFNLFNBQVVDLEdBQ2ZDLFFBQVFDLElBQUlGLEVBQUlHLFdBSXhCLFFBQVNJLEdBQUtDLEdBQ1YsTUFBSUEsR0FBTWQsR0FDQ0YsRUFBTWlCLElBQUksY0FBZUQsR0FBT1osS0FBSyxTQUFTQyxHQUNqRCxNQUFPQSxHQUFFQyxPQUNWQyxNQUFNLFNBQVNDLEdBQ2QsTUFBT0EsR0FBSUcsVUFHUlgsRUFBTWtCLEtBQUssY0FBZUYsR0FBT1osS0FBSyxTQUFVQyxHQUNuRCxNQUFPQSxHQUFFQyxPQUNWQyxNQUFNLFNBQVVDLEdBQ2YsTUFBT0EsR0FBSUcsVUFqQ3ZCLE9BQ0lWLFNBQVVBLEVBQ1ZXLFlBQWFBLEVBQ2JHLEtBQU1BLHNCQVBEbEIsU0FBUUMsT0FBTyxnQkFBZ0JxQixRQUFRLGlCQUFrQnBCLE1DRjFFLFdBQ0ksWUFF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LEdBQUkwQixFQUFNMUIsSUFFZHNELEtBQU0sT0FDUEMsT0FBT3JELEtBQUssU0FBVXFELEdBQ3JCNUQsUUFBUWdGLFFBQVFqRCxFQUFNZ0QsV0FBWSxTQUFVdEIsR0FDcENBLEVBQUtwRCxLQUFPMEIsRUFBTTFCLEtBQ2xCTCxRQUFRdUMsT0FBT2tCLEVBQU1HLEdBQ3JCN0IsRUFBTTFCLEdBQUtvRCxFQUFLcEQsT0FJekIsU0FBVXdELEdBQ1RqRCxRQUFRbUQsS0FBSyxvRkFBc0ZGLE1BbEQvRyxHQUFJNUQsR0FBU0QsUUFBUUMsT0FBTyxvQkF1RDVCQSxHQUFPc0IsVUFBVSxpQkFFYm1CLFVBQ0lyQyxHQUFJLEtBRVJtQixZQUFhLDJDQUNiTSxZQUFhLFFBQVMsWUFBYUEiLCJmaWxlIjoibW9kdWxlcy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL3NlcnZpY2VzLm1vZHVsZS5qc1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZXMnLCBbXSk7XHJcbiAgICB9XHJcbikoKTsiLCIvL3Byb2R1Y3Quc2VydmljZS5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZXMnKS5mYWN0b3J5KCdQcm9kdWN0U2VydmljZScsIG1lZGlhU2VydmljZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gbWVkaWFTZXJ2aWNlKCRodHRwKSB7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldE1lZGlhOiBnZXRNZWRpYSxcclxuICAgICAgICAgICAgZ2V0QWxsTWVkaWE6IGdldEFsbE1lZGlhLFxyXG4gICAgICAgICAgICBzYXZlOiBzYXZlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWVkaWEoaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnYXBpL3Byb2R1Y3QvJyArIGlkKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gci5kYXRhO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QWxsTWVkaWEoc2VhcmNoTW9kZWwpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnYXBpL3Byb2R1Y3QnLCB7IHBhcmFtczogc2VhcmNoTW9kZWwgfSkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHIuZGF0YTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNhdmUobWVkaWEpIHtcclxuICAgICAgICAgICAgaWYgKG1lZGlhLmlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KCdhcGkvcHJvZHVjdCcsIG1lZGlhKS50aGVuKGZ1bmN0aW9uKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gci5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVyci5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnYXBpL3Byb2R1Y3QnLCBtZWRpYSkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVyci5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxufVxyXG4pKCk7IiwiLy9wcm9kdWN0LWFwcC5tb2R1bGUuanNcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyxcclxuICAgIFtcclxuICAgICAgICAnYXBwLnNlcnZpY2VzJyxcclxuICAgICAgICAnYXBwLmRpcmVjdGl2ZXMnLFxyXG4gICAgICAgICdzaGFyZWQuY29tcG9uZW50cycsXHJcbiAgICAgICAgJ25nQ29tcG9uZW50Um91dGVyJyxcclxuICAgICAgICAndWkuYm9vdHN0cmFwJyxcclxuICAgICAgICAnc21hcnQtdGFibGUnXHJcbiAgICBdKTtcclxuXHJcbiAgICAvL21vZHVsZS5jb25maWcoZnVuY3Rpb24gKCkgey8vJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpOyB9KTtcclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdsaWJyYXJ5QXBwJyxcclxuICAgIHtcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvcHJvZHVjdC1hcHAuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgICRyb3V0ZUNvbmZpZzogW1xyXG4gICAgICAgICAgICB7IHBhdGg6ICcvJywgbmFtZTogJ0xpc3QnLCBjb21wb25lbnQ6ICdsaXN0JywgdXNlQXNEZWZhdWx0OiB0cnVlIH1cclxuICAgICAgICBdXHJcbiAgICB9KTtcclxuXHJcbiAgICBtb2R1bGUudmFsdWUoJyRyb3V0ZXJSb290Q29tcG9uZW50JywgJ2xpYnJhcnlBcHAnKTtcclxuXHJcbn0pKCk7IiwiLy9wdWJsaXNoZXItZWRpdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCkge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlkID0gJGN0cmwucmVzb2x2ZS5pZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoJGN0cmwuaWQpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnYXBpL3B1Ymxpc2hlci8nICsgJGN0cmwuaWQpLnRoZW4oZnVuY3Rpb24ocikge1xyXG4gICAgICAgICAgICAgICAgICAgICRjdHJsLnB1Ymxpc2hlciA9IHIuZGF0YTsgXHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgcmV0cml2aW5nIHB1Ymxpc2hlcicsIGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJyRjdHJsJywgJGN0cmwpO1xyXG4gICAgICAgICAgICBcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCdhcGkvcHVibGlzaGVyJywgJGN0cmwucHVibGlzaGVyKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCgkY3RybC5wdWJsaXNoZXIsIHIuZGF0YSk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBzYXZpbmcgcHVibGlzaGVyJywgZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlZGl0IHB1Ymxpc2hlcicsICRjdHJsLnB1Ymxpc2hlcik7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKCRjdHJsLnB1Ymxpc2hlcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgncHVibGlzaGVyRWRpdCcsXHJcbiAgICB7XHJcbiAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgaWQ6ICc8JywgXHJcbiAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcclxuICAgICAgICAgICAgY2xvc2U6ICcmJyxcclxuICAgICAgICAgICAgZGlzbWlzczogJyYnLFxyXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL3B1Ymxpc2hlci9wdWJsaXNoZXItZWRpdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsIGNvbnRyb2xsZXJdXHJcbiAgICB9KTtcclxuXHJcbn1cclxuKSgpOyIsIi8vcHJvZHVjdC1zdW1tYXJ5LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKHNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3VtbWFyeSBhY3RpdmUnKTtcclxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlkID0gJGN0cmwucmVzb2x2ZS5pZDtcclxuICAgICAgICAgICAgICAgICRjdHJsLmFzTW9kYWwgPSAkY3RybC5yZXNvbHZlLmFzTW9kYWw7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5hZGRTdGFmZlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2VydmljZS5nZXRNZWRpYSgkY3RybC5pZCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwubWVkaWEgPSByO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmNyZWF0ZVN0YWZmID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhZGQgc3RhZmYgbW9kYWwnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGN0cmwuZGlzbWlzcygpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnbWVkaWFTdW1tYXJ5JyxcclxuICAgIHtcclxuICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICBpZDogJzwnLFxyXG4gICAgICAgICAgICBhc01vZGFsOiAnPCcsXHJcbiAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcclxuICAgICAgICAgICAgY2xvc2U6ICcmJyxcclxuICAgICAgICAgICAgZGlzbWlzczogJyYnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9wcm9kdWN0L3Byb2R1Y3Qtc3VtbWFyeS5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogWydQcm9kdWN0U2VydmljZScsIGNvbnRyb2xsZXJdXHJcbiAgICB9KTtcclxuXHJcbn1cclxuKSgpOyIsIi8vcHJvZHVjdC1saXN0LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkdWliTW9kYWwsIHNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG4gICAgICAgIHZhciBwYWdlU2l6ZURlZmF1bHQgPSAxMDtcclxuICAgICAgICB2YXIgdGFibGVTdGF0ZVJlZjtcclxuXHJcbiAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwgPSB7XHJcbiAgICAgICAgICAgIHBhZ2U6IDEsXHJcbiAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZURlZmF1bHRcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge31cclxuXHJcbiAgICAgICAgJGN0cmwuc2VhcmNoID0gZnVuY3Rpb24gKHRhYmxlU3RhdGUpIHtcclxuICAgICAgICAgICAgdGFibGVTdGF0ZVJlZiA9IHRhYmxlU3RhdGU7XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLmdldEFsbE1lZGlhKCRjdHJsLnNlYXJjaE1vZGVsKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5tZWRpYSA9IHIucmVzdWx0cztcclxuICAgICAgICAgICAgICAgICRjdHJsLnNlYXJjaE1vZGVsID0gcjtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSAkY3RybC5zZWFyY2hNb2RlbC5yZXN1bHRzO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnBhZ2VkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC5zZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5lZGl0ID0gZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdtZWRpYUVkaXQnLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogaXRlbS5pZFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdsZydcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoaXRlbSwgcmVzdWx0KTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnbWVkaWFFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbGcnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGNsb3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZXN1bHQgd2FzLT5cIik7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oJ3JldHVybmluZyByZXN1bHQnLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwubWVkaWEudW5zaGlmdChyZXN1bHQpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBkaW1pc3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZWFzb24gd2FzLT5cIiArIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuc2hvd0RldGFpbHMgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnbWVkaWFTdW1tYXJ5JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxyXG4gICAgICAgICAgICAgICAgICAgIGFzTW9kYWw6IHRydWVcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbGcnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGNsb3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZXN1bHQgd2FzLT5cIik7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8ocmVzdWx0KTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgZGltaXNzZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVhc29uIHdhcy0+XCIgKyByZWFzb24pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ2xpc3QnLFxyXG4gICAge1xyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL3Byb2R1Y3QvcHJvZHVjdC1saXN0LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOiBbJyR1aWJNb2RhbCcsICdQcm9kdWN0U2VydmljZScsIGNvbnRyb2xsZXJdXHJcbiAgICB9KTtcclxuXHJcbn1cclxuKSgpOyIsIi8vcHJvZHVjdC1lZGl0LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKHNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoJGN0cmwucmVzb2x2ZSkge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuaWQgPSAkY3RybC5yZXNvbHZlLmlkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICgkY3RybC5pZCkge1xyXG4gICAgICAgICAgICAgICAgc2VydmljZS5nZXRNZWRpYSgkY3RybC5pZCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgICRjdHJsLm1lZGlhID0gcjtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlLnNhdmUoJGN0cmwubWVkaWEpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKCRjdHJsLm1lZGlhLCByKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIHNhdmluZyBwcm9kdWN0JywgZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLm1vZGFsSW5zdGFuY2UuY2xvc2UoJGN0cmwubWVkaWEpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ21lZGlhRWRpdCcsXHJcbiAgICB7XHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvcHJvZHVjdC9wcm9kdWN0LWVkaXQuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgIGlkOiAnPCcsXHJcbiAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcclxuICAgICAgICAgICAgY2xvc2U6ICcmJyxcclxuICAgICAgICAgICAgZGlzbWlzczogJyYnLFxyXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNvbnRyb2xsZXI6IFsnUHJvZHVjdFNlcnZpY2UnLCBjb250cm9sbGVyXVxyXG4gICAgfSk7XHJcbn0pKCk7XHJcbiAgICAiLCIvL2RpcmVjdGl2ZXMubW9kdWxlcy5qc1xyXG4oZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJywgW10pLmRpcmVjdGl2ZSgnc3RTdWJtaXRTZWFyY2gnLCBbJ3N0Q29uZmlnJywgJyR0aW1lb3V0JywgJyRwYXJzZScsIGZ1bmN0aW9uIChzdENvbmZpZywgJHRpbWVvdXQsICRwYXJzZSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICdec3RUYWJsZScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0ciwgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuYmluZCgnY2xpY2snLFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlQ3RybCA9IGN0cmw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlQ3RybC5waXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcclxuXHJcblxyXG59KSgpOyIsIi8vc2hhcmVkLWNvbXBvbmVudHMubW9kdWxlLmpzXHJcbihmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ3NoYXJlZC5jb21wb25lbnRzJywgW10pO1xyXG4gICAgfVxyXG4pKCk7IiwiLy9wdWJsaXNoZXItbGlzdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ3NoYXJlZC5jb21wb25lbnRzJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCwgJHVpYk1vZGFsKSB7XHJcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCdhcGkvcHVibGlzaGVyJykudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwucHVibGlzaGVycyA9IHIuZGF0YTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAncHVibGlzaGVyRWRpdCcsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ2xnJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBjbG9zZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVzdWx0IHdhcy0+XCIpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCdyZXR1cm5pbmcgcmVzdWx0JywgcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICRjdHJsLnB1Ymxpc2hlcnMudW5zaGlmdChyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuaWQgPSByZXN1bHQuaWQ7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGRpbWlzc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlYXNvbiB3YXMtPlwiICsgcmVhc29uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5lZGl0ID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAncHVibGlzaGVyRWRpdCcsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAkY3RybC5pZFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdsZydcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKCRjdHJsLnB1Ymxpc2hlcnMsIGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaWQgPT09ICRjdHJsLmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGl0ZW0sIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRjdHJsLmlkID0gaXRlbS5pZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGRpbWlzc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlYXNvbiB3YXMtPlwiICsgcmVhc29uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ3B1Ymxpc2hlckxpc3QnLFxyXG4gICAge1xyXG4gICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgIGlkOiAnPSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2NvbW1vbi9wdWJsaXNoZXItbGlzdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsICckdWliTW9kYWwnLCBjb250cm9sbGVyXVxyXG4gICAgfSk7XHJcblxyXG5cclxufVxyXG4pKCk7Il19
