!function(){angular.module("app.services",[])}(),function(){"use strict";function n(n){function e(e){return n.get("api/product/"+e).then(function(n){return n.data}).catch(function(n){console.log(n.message)})}function o(e){return n.get("api/product",{params:e}).then(function(n){return n.data}).catch(function(n){console.log(n.message)})}function t(e){return e.id?n.put("api/product",e).then(function(n){return n.data}).catch(function(n){return n.message}):n.post("api/product",e).then(function(n){return n.data}).catch(function(n){return n.message})}return{getMedia:e,getAllMedia:o,save:t}}n.$inject=["$http"];angular.module("app.services").factory("ProductService",n)}(),function(){"use strict";var n=angular.module("app",["app.services","app.directives","shared.components","ngComponentRouter","ui.bootstrap","smart-table"]);n.component("libraryApp",{templateUrl:"/app/product-app.component.html",$routeConfig:[{path:"/",name:"List",component:"list",useAsDefault:!0}]}),n.value("$routerRootComponent","libraryApp")}(),function(){function n(n){var e=this;e.$onInit=function(){e.resolve&&(e.id=e.resolve.id),e.id&&n.get("api/publisher/"+e.id).then(function(n){e.publisher=n.data}).catch(function(n){console.log("Error retriving publisher",n.message)}).finally(function(){}),console.log("$ctrl",e)},e.cancel=function(){e.dismiss()},e.save=function(){return n.post("api/publisher",e.publisher).then(function(n){angular.extend(e.publisher,n.data)}).catch(function(n){console.log("Error saving publisher",n.message)}).finally(function(){console.log("edit publisher",e.publisher),e.modalInstance.close(e.publisher)})}}var e=angular.module("app");e.component("publisherEdit",{bindings:{id:"<",resolve:"<",close:"&",dismiss:"&",modalInstance:"<"},templateUrl:"app/publisher/publisher-edit.component.html",controller:["$http",n]})}(),function(){function n(n){var e=this;e.$onInit=function(){console.log("summary active"),e.resolve&&(e.id=e.resolve.id,e.asModal=e.resolve.asModal,e.addStaffVisible=!1),n.getMedia(e.id).then(function(n){e.media=n})},e.createStaff=function(){console.log("add staff modal")},e.cancel=function(){e.dismiss()}}var e=angular.module("app");e.component("mediaSummary",{bindings:{id:"<",asModal:"<",resolve:"<",close:"&",dismiss:"&"},templateUrl:"app/product/product-summary.component.html",controller:["ProductService",n]})}(),function(){"use strict";function n(n,e){var o,t=this,i=10;t.searchModel={page:1,pageSize:i},t.$onInit=function(){},t.search=function(n){o=n,e.getAllMedia(t.searchModel).then(function(n){t.media=n.results,t.searchModel=n,delete t.searchModel.results})},t.paged=function(){t.search(o)},t.edit=function(e){angular.copy(e);n.open({component:"mediaEdit",bindings:{modalInstance:"<"},resolve:{id:e.id},size:"lg"}).result.then(function(n){angular.extend(e,n)},function(n){})},t.create=function(){n.open({component:"mediaEdit",bindings:{modalInstance:"<"},size:"lg"}).result.then(function(n){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),console.info("returning result",n),t.media.unshift(n)},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})},t.showDetails=function(e){n.open({component:"mediaSummary",bindings:{modalInstance:"<"},resolve:{id:e,asModal:!0},size:"lg"}).result.then(function(n){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),console.info(n)},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})}}var e=angular.module("app");e.component("list",{templateUrl:"app/product/product-list.component.html",controller:["$uibModal","ProductService",n]})}(),function(){function n(n){var e=this;e.$onInit=function(){e.resolve&&(e.id=e.resolve.id),e.id&&n.getMedia(e.id).then(function(n){e.media=n})},e.cancel=function(){e.dismiss()},e.save=function(){return n.save(e.media).then(function(n){angular.extend(e.media,n)}).catch(function(n){console.log("Error saving product",n.message)}).finally(function(){e.modalInstance.close(e.media)})}}var e=angular.module("app");e.component("mediaEdit",{templateUrl:"app/product/product-edit.component.html",bindings:{id:"<",resolve:"<",close:"&",dismiss:"&",modalInstance:"<"},controller:["ProductService",n]})}(),function(){angular.module("app.directives",[]).directive("stSubmitSearch",["stConfig","$timeout","$parse",function(n,e,o){return{require:"^stTable",link:function(n,e,o,t){return e.bind("click",function(){var n=t;n.pipe()})}}}])}(),function(){angular.module("shared.components",[])}(),function(){function n(n,e){var o=this;o.$onInit=function(){n.get("api/publisher").then(function(n){o.publishers=n.data}).catch(function(n){console.log(n.message)})},o.create=function(){e.open({component:"publisherEdit",bindings:{modalInstance:"<"},size:"lg"}).result.then(function(n){console.info("I was closed, so do what I need to do myContent's controller now.  Result was->"),console.info("returning result",n),o.publishers.unshift(n),o.id=n.id},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})},o.edit=function(){e.open({component:"publisherEdit",bindings:{modalInstance:"<"},resolve:{id:o.id},size:"lg"}).result.then(function(n){angular.forEach(o.publishers,function(e){e.id===o.id&&(angular.extend(e,n),o.id=e.id)})},function(n){console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->"+n)})}}var e=angular.module("shared.components");e.component("publisherList",{bindings:{id:"="},templateUrl:"app/common/publisher-list.component.html",controller:["$http","$uibModal",n]})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VzL3NlcnZpY2VzLm1vZHVsZS5qcyIsInNlcnZpY2VzL3Byb2R1Y3Quc2VydmljZS5qcyIsInByb2R1Y3QtYXBwLm1vZHVsZS5qcyIsInB1Ymxpc2hlci9wdWJsaXNoZXItZWRpdC5jb21wb25lbnQuanMiLCJwcm9kdWN0L3Byb2R1Y3Qtc3VtbWFyeS5jb21wb25lbnQuanMiLCJwcm9kdWN0L3Byb2R1Y3QtbGlzdC5jb21wb25lbnQuanMiLCJwcm9kdWN0L3Byb2R1Y3QtZWRpdC5jb21wb25lbnQuanMiLCJkaXJlY3RpdmVzL2RpcmVjdGl2ZXMubW9kdWxlcy5qcyIsImNvbW1vbi9jb21wb25lbnRzLm1vZHVsZS5qcyIsImNvbW1vbi9wdWJsaXNoZXItbGlzdC5jb21wb25lbnQuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsIm1lZGlhU2VydmljZSIsIiRodHRwIiwiZ2V0TWVkaWEiLCJpZCIsImdldCIsInRoZW4iLCJyIiwiZGF0YSIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsIm1lc3NhZ2UiLCJnZXRBbGxNZWRpYSIsInNlYXJjaE1vZGVsIiwicGFyYW1zIiwic2F2ZSIsIm1lZGlhIiwicHV0IiwicG9zdCIsImZhY3RvcnkiLCJjb21wb25lbnQiLCJ0ZW1wbGF0ZVVybCIsIiRyb3V0ZUNvbmZpZyIsInBhdGgiLCJuYW1lIiwidXNlQXNEZWZhdWx0IiwidmFsdWUiLCJjb250cm9sbGVyIiwiJGN0cmwiLCJ0aGlzIiwiJG9uSW5pdCIsInJlc29sdmUiLCJwdWJsaXNoZXIiLCJmaW5hbGx5IiwiY2FuY2VsIiwiZGlzbWlzcyIsImV4dGVuZCIsIm1vZGFsSW5zdGFuY2UiLCJjbG9zZSIsImJpbmRpbmdzIiwic2VydmljZSIsImFzTW9kYWwiLCJhZGRTdGFmZlZpc2libGUiLCJjcmVhdGVTdGFmZiIsIiR1aWJNb2RhbCIsInRhYmxlU3RhdGVSZWYiLCJwYWdlU2l6ZURlZmF1bHQiLCJwYWdlIiwicGFnZVNpemUiLCJzZWFyY2giLCJ0YWJsZVN0YXRlIiwicmVzdWx0cyIsInBhZ2VkIiwiZWRpdCIsIml0ZW0iLCJjb3B5Iiwib3BlbiIsInNpemUiLCJyZXN1bHQiLCJyZWFzb24iLCJjcmVhdGUiLCJpbmZvIiwidW5zaGlmdCIsInNob3dEZXRhaWxzIiwiZGlyZWN0aXZlIiwic3RDb25maWciLCIkdGltZW91dCIsIiRwYXJzZSIsInJlcXVpcmUiLCJsaW5rIiwic2NvcGUiLCJlbGVtZW50IiwiYXR0ciIsImN0cmwiLCJiaW5kIiwidGFibGVDdHJsIiwicGlwZSIsInB1Ymxpc2hlcnMiLCJmb3JFYWNoIl0sIm1hcHBpbmdzIjoiQ0FDQSxXQUNxQkEsUUFBUUMsT0FBTyxzQkNEcEMsV0FDSSxZQUdBLFNBQVNDLEdBQWFDLEdBUWxCLFFBQVNDLEdBQVNDLEdBQ2QsTUFBT0YsR0FBTUcsSUFBSSxlQUFpQkQsR0FBSUUsS0FBSyxTQUFVQyxHQUNqRCxNQUFPQSxHQUFFQyxPQUNWQyxNQUFNLFNBQVVDLEdBQ2ZDLFFBQVFDLElBQUlGLEVBQUlHLFdBSXhCLFFBQVNDLEdBQVlDLEdBQ2pCLE1BQU9iLEdBQU1HLElBQUksZUFBaUJXLE9BQVFELElBQWVULEtBQUssU0FBVUMsR0FDcEUsTUFBT0EsR0FBRUMsT0FDVkMsTUFBTSxTQUFVQyxHQUNmQyxRQUFRQyxJQUFJRixFQUFJRyxXQUl4QixRQUFTSSxHQUFLQyxHQUNWLE1BQUlBLEdBQU1kLEdBQ0NGLEVBQU1pQixJQUFJLGNBQWVELEdBQU9aLEtBQUssU0FBU0MsR0FDakQsTUFBT0EsR0FBRUMsT0FDVkMsTUFBTSxTQUFTQyxHQUNkLE1BQU9BLEdBQUlHLFVBR1JYLEVBQU1rQixLQUFLLGNBQWVGLEdBQU9aLEtBQUssU0FBVUMsR0FDbkQsTUFBT0EsR0FBRUMsT0FDVkMsTUFBTSxTQUFVQyxHQUNmLE1BQU9BLEdBQUlHLFVBakN2QixPQUNJVixTQUFVQSxFQUNWVyxZQUFhQSxFQUNiRyxLQUFNQSxzQkFQRGxCLFNBQVFDLE9BQU8sZ0JBQWdCcUIsUUFBUSxpQkFBa0JwQixNQ0YxRSxX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QUNYbUIsVUFDSUYsY0FBZSxLQUVuQk4sU0FDSTdCLEdBQUkwQixFQUFNMUIsSUFFZHVELEtBQU0sT0FDUEMsT0FBT3RELEtBQUssU0FBVXNELEdBQ3JCN0QsUUFBUWlGLFFBQVFsRCxFQUFNaUQsV0FBWSxTQUFVdkIsR0FDcENBLEVBQUtwRCxLQUFPMEIsRUFBTTFCLEtBQ2xCTCxRQUFRdUMsT0FBT2tCLEVBQU1JLEdBQ3JCOUIsRUFBTTFCLEdBQUtvRCxFQUFLcEQsT0FJekIsU0FBVXlELEdBQ1RsRCxRQUFRb0QsS0FBSyxvRkFBc0ZGLE1BbEQvRyxHQUFJN0QsR0FBU0QsUUFBUUMsT0FBTyxvQkF1RDVCQSxHQUFPc0IsVUFBVSxpQkFFYm1CLFVBQ0lyQyxHQUFJLEtBRVJtQixZQUFhLDJDQUNiTSxZQUFhLFFBQVMsWUFBYUEiLCJmaWxlIjoibW9kdWxlcy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL3NlcnZpY2VzLm1vZHVsZS5qc1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZXMnLCBbXSk7XHJcbiAgICB9XHJcbikoKTsiLCIvL3Byb2R1Y3Quc2VydmljZS5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZXMnKS5mYWN0b3J5KCdQcm9kdWN0U2VydmljZScsIG1lZGlhU2VydmljZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gbWVkaWFTZXJ2aWNlKCRodHRwKSB7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldE1lZGlhOiBnZXRNZWRpYSxcclxuICAgICAgICAgICAgZ2V0QWxsTWVkaWE6IGdldEFsbE1lZGlhLFxyXG4gICAgICAgICAgICBzYXZlOiBzYXZlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWVkaWEoaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnYXBpL3Byb2R1Y3QvJyArIGlkKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gci5kYXRhO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QWxsTWVkaWEoc2VhcmNoTW9kZWwpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnYXBpL3Byb2R1Y3QnLCB7IHBhcmFtczogc2VhcmNoTW9kZWwgfSkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHIuZGF0YTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNhdmUobWVkaWEpIHtcclxuICAgICAgICAgICAgaWYgKG1lZGlhLmlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KCdhcGkvcHJvZHVjdCcsIG1lZGlhKS50aGVuKGZ1bmN0aW9uKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gci5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVyci5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnYXBpL3Byb2R1Y3QnLCBtZWRpYSkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVyci5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxufVxyXG4pKCk7IiwiLy9wcm9kdWN0LWFwcC5tb2R1bGUuanNcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyxcclxuICAgIFtcclxuICAgICAgICAnYXBwLnNlcnZpY2VzJyxcclxuICAgICAgICAnYXBwLmRpcmVjdGl2ZXMnLFxyXG4gICAgICAgICdzaGFyZWQuY29tcG9uZW50cycsXHJcbiAgICAgICAgJ25nQ29tcG9uZW50Um91dGVyJyxcclxuICAgICAgICAndWkuYm9vdHN0cmFwJyxcclxuICAgICAgICAnc21hcnQtdGFibGUnXHJcbiAgICBdKTtcclxuXHJcbiAgICAvL21vZHVsZS5jb25maWcoZnVuY3Rpb24gKCkgey8vJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpOyB9KTtcclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdsaWJyYXJ5QXBwJyxcclxuICAgIHtcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvcHJvZHVjdC1hcHAuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgICRyb3V0ZUNvbmZpZzogW1xyXG4gICAgICAgICAgICB7IHBhdGg6ICcvJywgbmFtZTogJ0xpc3QnLCBjb21wb25lbnQ6ICdsaXN0JywgdXNlQXNEZWZhdWx0OiB0cnVlIH1cclxuICAgICAgICBdXHJcbiAgICB9KTtcclxuXHJcbiAgICBtb2R1bGUudmFsdWUoJyRyb3V0ZXJSb290Q29tcG9uZW50JywgJ2xpYnJhcnlBcHAnKTtcclxuXHJcbn0pKCk7IiwiLy9wdWJsaXNoZXItZWRpdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCkge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlkID0gJGN0cmwucmVzb2x2ZS5pZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoJGN0cmwuaWQpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnYXBpL3B1Ymxpc2hlci8nICsgJGN0cmwuaWQpLnRoZW4oZnVuY3Rpb24ocikge1xyXG4gICAgICAgICAgICAgICAgICAgICRjdHJsLnB1Ymxpc2hlciA9IHIuZGF0YTsgXHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgcmV0cml2aW5nIHB1Ymxpc2hlcicsIGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJyRjdHJsJywgJGN0cmwpO1xyXG4gICAgICAgICAgICBcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCdhcGkvcHVibGlzaGVyJywgJGN0cmwucHVibGlzaGVyKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCgkY3RybC5wdWJsaXNoZXIsIHIuZGF0YSk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBzYXZpbmcgcHVibGlzaGVyJywgZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlZGl0IHB1Ymxpc2hlcicsICRjdHJsLnB1Ymxpc2hlcik7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKCRjdHJsLnB1Ymxpc2hlcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgncHVibGlzaGVyRWRpdCcsXHJcbiAgICB7XHJcbiAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgaWQ6ICc8JywgXHJcbiAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcclxuICAgICAgICAgICAgY2xvc2U6ICcmJyxcclxuICAgICAgICAgICAgZGlzbWlzczogJyYnLFxyXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL3B1Ymxpc2hlci9wdWJsaXNoZXItZWRpdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsIGNvbnRyb2xsZXJdXHJcbiAgICB9KTtcclxuXHJcbn1cclxuKSgpOyIsIi8vcHJvZHVjdC1zdW1tYXJ5LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKHNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3VtbWFyeSBhY3RpdmUnKTtcclxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlkID0gJGN0cmwucmVzb2x2ZS5pZDtcclxuICAgICAgICAgICAgICAgICRjdHJsLmFzTW9kYWwgPSAkY3RybC5yZXNvbHZlLmFzTW9kYWw7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5hZGRTdGFmZlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2VydmljZS5nZXRNZWRpYSgkY3RybC5pZCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwubWVkaWEgPSByO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmNyZWF0ZVN0YWZmID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhZGQgc3RhZmYgbW9kYWwnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGN0cmwuZGlzbWlzcygpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnbWVkaWFTdW1tYXJ5JyxcclxuICAgIHtcclxuICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICBpZDogJzwnLFxyXG4gICAgICAgICAgICBhc01vZGFsOiAnPCcsXHJcbiAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcclxuICAgICAgICAgICAgY2xvc2U6ICcmJyxcclxuICAgICAgICAgICAgZGlzbWlzczogJyYnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9wcm9kdWN0L3Byb2R1Y3Qtc3VtbWFyeS5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogWydQcm9kdWN0U2VydmljZScsIGNvbnRyb2xsZXJdXHJcbiAgICB9KTtcclxuXHJcbn1cclxuKSgpOyIsIi8vcHJvZHVjdC1saXN0LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkdWliTW9kYWwsIHNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG4gICAgICAgIHZhciBwYWdlU2l6ZURlZmF1bHQgPSAxMDtcclxuICAgICAgICB2YXIgdGFibGVTdGF0ZVJlZjtcclxuXHJcbiAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwgPSB7XHJcbiAgICAgICAgICAgIHBhZ2U6IDEsXHJcbiAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZURlZmF1bHRcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge31cclxuXHJcbiAgICAgICAgJGN0cmwuc2VhcmNoID0gZnVuY3Rpb24gKHRhYmxlU3RhdGUpIHtcclxuICAgICAgICAgICAgdGFibGVTdGF0ZVJlZiA9IHRhYmxlU3RhdGU7XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLmdldEFsbE1lZGlhKCRjdHJsLnNlYXJjaE1vZGVsKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5tZWRpYSA9IHIucmVzdWx0cztcclxuICAgICAgICAgICAgICAgICRjdHJsLnNlYXJjaE1vZGVsID0gcjtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSAkY3RybC5zZWFyY2hNb2RlbC5yZXN1bHRzO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnBhZ2VkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC5zZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5lZGl0ID0gZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWRNZWRpYSA9IGFuZ3VsYXIuY29weShpdGVtKTsgXHJcbiAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ21lZGlhRWRpdCcsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBpdGVtLmlkXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ2xnJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUuaW5mbyhcIkkgd2FzIGNsb3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZXN1bHQgd2FzLT5cIik7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChpdGVtLCByZXN1bHQpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUuaW5mbyhcIkkgd2FzIGRpbWlzc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlYXNvbiB3YXMtPlwiICsgcmVhc29uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ21lZGlhRWRpdCcsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ2xnJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBjbG9zZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVzdWx0IHdhcy0+XCIpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCdyZXR1cm5pbmcgcmVzdWx0JywgcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICRjdHJsLm1lZGlhLnVuc2hpZnQocmVzdWx0KTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgZGltaXNzZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVhc29uIHdhcy0+XCIgKyByZWFzb24pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnNob3dEZXRhaWxzID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ21lZGlhU3VtbWFyeScsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcclxuICAgICAgICAgICAgICAgICAgICBhc01vZGFsOiB0cnVlXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ2xnJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBjbG9zZWQsIHNvIGRvIHdoYXQgSSBuZWVkIHRvIGRvIG15Q29udGVudCdzIGNvbnRyb2xsZXIgbm93LiAgUmVzdWx0IHdhcy0+XCIpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGRpbWlzc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlYXNvbiB3YXMtPlwiICsgcmVhc29uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdsaXN0JyxcclxuICAgIHtcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9wcm9kdWN0L3Byb2R1Y3QtbGlzdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogWyckdWliTW9kYWwnLCAnUHJvZHVjdFNlcnZpY2UnLCBjb250cm9sbGVyXVxyXG4gICAgfSk7XHJcblxyXG59XHJcbikoKTsiLCIvL3Byb2R1Y3QtZWRpdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcihzZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlkID0gJGN0cmwucmVzb2x2ZS5pZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoJGN0cmwuaWQpIHtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2UuZ2V0TWVkaWEoJGN0cmwuaWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICAkY3RybC5tZWRpYSA9IHI7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gc2VydmljZS5zYXZlKCRjdHJsLm1lZGlhKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCgkY3RybC5tZWRpYSwgcik7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBzYXZpbmcgcHJvZHVjdCcsIGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKCRjdHJsLm1lZGlhKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdtZWRpYUVkaXQnLFxyXG4gICAge1xyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL3Byb2R1Y3QvcHJvZHVjdC1lZGl0LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICBpZDogJzwnLFxyXG4gICAgICAgICAgICByZXNvbHZlOiAnPCcsXHJcbiAgICAgICAgICAgIGNsb3NlOiAnJicsXHJcbiAgICAgICAgICAgIGRpc21pc3M6ICcmJyxcclxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogJzwnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb250cm9sbGVyOiBbJ1Byb2R1Y3RTZXJ2aWNlJywgY29udHJvbGxlcl1cclxuICAgIH0pO1xyXG59KSgpO1xyXG4gICAgIiwiLy9kaXJlY3RpdmVzLm1vZHVsZXMuanNcclxuKGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycsIFtdKS5kaXJlY3RpdmUoJ3N0U3VibWl0U2VhcmNoJywgWydzdENvbmZpZycsICckdGltZW91dCcsICckcGFyc2UnLCBmdW5jdGlvbiAoc3RDb25maWcsICR0aW1lb3V0LCAkcGFyc2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1aXJlOiAnXnN0VGFibGUnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHIsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmJpbmQoJ2NsaWNrJyxcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZUN0cmwgPSBjdHJsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XHJcblxyXG5cclxufSkoKTsiLCIvL3NoYXJlZC1jb21wb25lbnRzLm1vZHVsZS5qc1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdzaGFyZWQuY29tcG9uZW50cycsIFtdKTtcclxuICAgIH1cclxuKSgpOyIsIi8vcHVibGlzaGVyLWxpc3QuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdzaGFyZWQuY29tcG9uZW50cycpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJGh0dHAsICR1aWJNb2RhbCkge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL3B1Ymxpc2hlcicpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnB1Ymxpc2hlcnMgPSByLmRhdGE7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ3B1Ymxpc2hlckVkaXQnLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdsZydcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgY2xvc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlc3VsdCB3YXMtPlwiKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbygncmV0dXJuaW5nIHJlc3VsdCcsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5wdWJsaXNoZXJzLnVuc2hpZnQocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlkID0gcmVzdWx0LmlkO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBkaW1pc3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZWFzb24gd2FzLT5cIiArIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuZWRpdCA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ3B1Ymxpc2hlckVkaXQnLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogJGN0cmwuaWRcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbGcnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkY3RybC5wdWJsaXNoZXJzLCBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmlkID09PSAkY3RybC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChpdGVtLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkY3RybC5pZCA9IGl0ZW0uaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBkaW1pc3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZWFzb24gd2FzLT5cIiArIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdwdWJsaXNoZXJMaXN0JyxcclxuICAgIHtcclxuICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICBpZDogJz0nXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9jb21tb24vcHVibGlzaGVyLWxpc3QuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAnJHVpYk1vZGFsJywgY29udHJvbGxlcl1cclxuICAgIH0pO1xyXG5cclxuXHJcbn1cclxuKSgpOyJdfQ==
