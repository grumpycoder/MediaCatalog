//app.module.js
(function() {
    'use strict';

    var module = angular.module('media',
    [
        'app.service',
        'app.directives', 
        'ngComponentRouter',
        'ui.bootstrap',
        'smart-table'
    ]);

    //module.config(function () {//$locationProvider.html5Mode(true); });

    module.component('mediaApp',
    {
        templateUrl: '/app/media/media-app.component.html',
        $routeConfig: [
            { path: '/', name: 'List', component: 'list', useAsDefault: true }
            //{ path: '/:id', name: 'Details', component: 'detail' },
            //{ path: '/edit/:id', name: 'Edit', component: 'edit' },
            //{ path: '/create', name: 'Create', component: 'create' }
        ]
    });

    module.value('$routerRootComponent', 'mediaApp');

})();
//media-edit.component.js
(function () {
    var module = angular.module('media');

    function controller(service) {
        var $ctrl = this;

        $ctrl.$onInit = function () {
            if ($ctrl.resolve) {
                $ctrl.id = $ctrl.resolve.id;
            }
            service.getMedia($ctrl.id).then(function(r) {
                $ctrl.media = r; 
            });
            console.log('media edit active', $ctrl);
        }

        $ctrl.cancel = function()
        {
            $ctrl.dismiss();
        }

        $ctrl.save = function () {
            service.save($ctrl.media).then(function(r) {
                angular.extend($ctrl.media, r);
            }).catch(function(err) {

            });
            this.modalInstance.close($ctrl.media);
        }

    }

    module.component('mediaEdit',
    {
        templateUrl: 'app/media/media-edit.component.html',
        bindings: {
            id: '<',
            resolve: '<',
            close: '&',
            dismiss: '&',
            modalInstance: '<'
        },
        controller: ['MediaService', controller]
    });
})();

//media-list.component.js
(function () {
    'use strict';

    var module = angular.module('media');

    function controller($uibModal, service) {
        var $ctrl = this;
        var pageSizeDefault = 10;
        var tableStateRef;

        $ctrl.searchModel = {
            page: 1,
            pageSize: pageSizeDefault
        };

        $ctrl.$onInit = function () {
        }

        $ctrl.search = function (tableState) {
            tableStateRef = tableState;

            service.getAllMedia($ctrl.searchModel).then(function (r) {
                $ctrl.media = r.results;
                $ctrl.searchModel = r;
                delete $ctrl.searchModel.results;
            });
        }

        $ctrl.paged = function () {
            $ctrl.search(tableStateRef);
        }

        $ctrl.edit = function(item) {
            $ctrl.selectedMedia = item; 
            $uibModal.open({
                component: 'mediaEdit',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    id: item.id
                },
                size: 'lg'
            }).result.then(function (result) {
                console.info("I was closed, so do what I need to do myContent's controller now.  Result was->");
                console.info(result);
                angular.extend($ctrl.selectedMedia, result);
            }, function (reason) {
                console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->" + reason);
            });
        }

        $ctrl.showDetails = function (id) {
            $uibModal.open({
                component: 'mediaSummary',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    id: id,
                    asModal: true
                },
                size: 'lg'
            }).result.then(function (result) {
                console.info("I was closed, so do what I need to do myContent's controller now.  Result was->");
                console.info(result);
            }, function (reason) {
                console.info("I was dimissed, so do what I need to do myContent's controller now.  Reason was->" + reason);
            });
        }

    }

    module.component('list',
    {
        templateUrl: 'app/media/media-list.component.html',
        controller: ['$uibModal', 'MediaService', controller]
    });

}
)();
//media-summary.component.js
(function () {
    var module = angular.module('media');

    function controller(service) {
        var $ctrl = this;

        $ctrl.$onInit = function () {
            console.log('summary active');
            if ($ctrl.resolve) {
                $ctrl.id = $ctrl.resolve.id;
                $ctrl.asModal = $ctrl.resolve.asModal;
            }

            service.getMedia($ctrl.id).then(function (r) {
                $ctrl.media = r;
            });
        }

        $ctrl.cancel = function () {
            $ctrl.dismiss();
        };
    }

    module.component('mediaSummary',
    {
        bindings: {
            id: '<',
            asModal: '<',
            resolve: '<',
            close: '&',
            dismiss: '&'
        },
        templateUrl: 'app/media/media-summary.component.html',
        controller: ['MediaService', controller]
    });

}
)();
//app-directives.modules.js
(function() {

    angular.module('app.directives', []).directive('stSubmitSearch', ['stConfig', '$timeout', '$parse', function (stConfig, $timeout, $parse) {
        return {
            require: '^stTable',
            link: function (scope, element, attr, ctrl) {
                return element.bind('click',
                    function () {
                        var tableCtrl = ctrl;
                        tableCtrl.pipe();
                    });

            }
        };
    }]);


})();
//app.service.js
(function() {
        var module = angular.module('app.service', []);
    }
)();
//media.service.js
(function () {
    'use strict';
    mediaService.$inject = ["$http"];
    var module = angular.module('app.service').factory('MediaService', mediaService);

    function mediaService($http) {

        return {
            getMedia: getMedia,
            getAllMedia: getAllMedia,
            save: save
        };

        function getMedia(id) {
            return $http.get('api/media/' + id).then(function (r) {
                return r.data;
            }).catch(function (err) {
                console.log(err.message);
            });
        }

        function getAllMedia(searchModel) {
            return $http.get('api/media', { params: searchModel }).then(function (r) {
                return r.data;
            }).catch(function (err) {
                console.log(err.message);
            });
        }

        function save(media) {
            return $http.put('api/media', media).then(function (r) {
                return r.data; 
            }).catch(function (err) {
                return err.message;
            });
        }

    }

}
)();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lZGlhL21lZGlhLWFwcC5tb2R1bGUuanMiLCJtZWRpYS9tZWRpYS1lZGl0LmNvbXBvbmVudC5qcyIsIm1lZGlhL21lZGlhLWxpc3QuY29tcG9uZW50LmpzIiwibWVkaWEvbWVkaWEtc3VtbWFyeS5jb21wb25lbnQuanMiLCJkaXJlY3RpdmVzL2FwcC1kaXJlY3RpdmVzLm1vZHVsZXMuanMiLCJzZXJ2aWNlcy9hcHAtc2VydmljZS5tb2R1bGUuanMiLCJzZXJ2aWNlcy9tZWRpYS5zZXJ2aWNlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0EsQ0FBQyxXQUFXO0lBQ1I7O0lBRUEsSUFBSSxTQUFTLFFBQVEsT0FBTztJQUM1QjtRQUNJO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7Ozs7O0lBS0osT0FBTyxVQUFVO0lBQ2pCO1FBQ0ksYUFBYTtRQUNiLGNBQWM7WUFDVixFQUFFLE1BQU0sS0FBSyxNQUFNLFFBQVEsV0FBVyxRQUFRLGNBQWM7Ozs7Ozs7SUFPcEUsT0FBTyxNQUFNLHdCQUF3Qjs7S0FFcEM7QUM1Qkw7QUFDQSxDQUFDLFlBQVk7SUFDVCxJQUFJLFNBQVMsUUFBUSxPQUFPOztJQUU1QixTQUFTLFdBQVcsU0FBUztRQUN6QixJQUFJLFFBQVE7O1FBRVosTUFBTSxVQUFVLFlBQVk7WUFDeEIsSUFBSSxNQUFNLFNBQVM7Z0JBQ2YsTUFBTSxLQUFLLE1BQU0sUUFBUTs7WUFFN0IsUUFBUSxTQUFTLE1BQU0sSUFBSSxLQUFLLFNBQVMsR0FBRztnQkFDeEMsTUFBTSxRQUFROztZQUVsQixRQUFRLElBQUkscUJBQXFCOzs7UUFHckMsTUFBTSxTQUFTO1FBQ2Y7WUFDSSxNQUFNOzs7UUFHVixNQUFNLE9BQU8sWUFBWTtZQUNyQixRQUFRLEtBQUssTUFBTSxPQUFPLEtBQUssU0FBUyxHQUFHO2dCQUN2QyxRQUFRLE9BQU8sTUFBTSxPQUFPO2VBQzdCLE1BQU0sU0FBUyxLQUFLOzs7WUFHdkIsS0FBSyxjQUFjLE1BQU0sTUFBTTs7Ozs7SUFLdkMs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UUFBUSxnQkFBZ0I7O0lBRW5FLFNBQVMsYUFBYSxPQUFPOztRQUV6QixPQUFPO1lBQ0gsVUFBVTtZQUNWLGFBQWE7WUFDYixNQUFNOzs7UUFHVixTQUFTLFNBQVMsSUFBSTtZQUNsQixPQUFPLE1BQU0sSUFBSSxlQUFlLElBQUksS0FBSyxVQUFVLEdBQUc7Z0JBQ2xELE9BQU8sRUFBRTtlQUNWLE1BQU0sVUFBVSxLQUFLO2dCQUNwQixRQUFRLElBQUksSUFBSTs7OztRQUl4QixTQUFTLFlBQVksYUFBYTtZQUM5QixPQUFPLE1BQU0sSUFBSSxhQUFhLEVBQUUsUUFBUSxlQUFlLEtBQUssVUFBVSxHQUFHO2dCQUNyRSxPQUFPLEVBQUU7ZUFDVixNQUFNLFVBQVUsS0FBSztnQkFDcEIsUUFBUSxJQUFJLElBQUk7Ozs7UUFJeEIsU0FBUyxLQUFLLE9BQU87WUFDakIsT0FBTyxNQUFNLElBQUksYUFBYSxPQUFPLEtBQUssVUFBVSxHQUFHO2dCQUNuRCxPQUFPLEVBQUU7ZUFDVixNQUFNLFVBQVUsS0FBSztnQkFDcEIsT0FBTyxJQUFJOzs7Ozs7O0lBT3ZCIiwiZmlsZSI6Im1vZHVsZXMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9hcHAubW9kdWxlLmpzXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ21lZGlhJyxcclxuICAgIFtcclxuICAgICAgICAnYXBwLnNlcnZpY2UnLFxyXG4gICAgICAgICdhcHAuZGlyZWN0aXZlcycsIFxyXG4gICAgICAgICduZ0NvbXBvbmVudFJvdXRlcicsXHJcbiAgICAgICAgJ3VpLmJvb3RzdHJhcCcsXHJcbiAgICAgICAgJ3NtYXJ0LXRhYmxlJ1xyXG4gICAgXSk7XHJcblxyXG4gICAgLy9tb2R1bGUuY29uZmlnKGZ1bmN0aW9uICgpIHsvLyRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTsgfSk7XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnbWVkaWFBcHAnLFxyXG4gICAge1xyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9tZWRpYS9tZWRpYS1hcHAuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgICRyb3V0ZUNvbmZpZzogW1xyXG4gICAgICAgICAgICB7IHBhdGg6ICcvJywgbmFtZTogJ0xpc3QnLCBjb21wb25lbnQ6ICdsaXN0JywgdXNlQXNEZWZhdWx0OiB0cnVlIH1cclxuICAgICAgICAgICAgLy97IHBhdGg6ICcvOmlkJywgbmFtZTogJ0RldGFpbHMnLCBjb21wb25lbnQ6ICdkZXRhaWwnIH0sXHJcbiAgICAgICAgICAgIC8veyBwYXRoOiAnL2VkaXQvOmlkJywgbmFtZTogJ0VkaXQnLCBjb21wb25lbnQ6ICdlZGl0JyB9LFxyXG4gICAgICAgICAgICAvL3sgcGF0aDogJy9jcmVhdGUnLCBuYW1lOiAnQ3JlYXRlJywgY29tcG9uZW50OiAnY3JlYXRlJyB9XHJcbiAgICAgICAgXVxyXG4gICAgfSk7XHJcblxyXG4gICAgbW9kdWxlLnZhbHVlKCckcm91dGVyUm9vdENvbXBvbmVudCcsICdtZWRpYUFwcCcpO1xyXG5cclxufSkoKTsiLCIvL21lZGlhLWVkaXQuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ21lZGlhJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcihzZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlkID0gJGN0cmwucmVzb2x2ZS5pZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXJ2aWNlLmdldE1lZGlhKCRjdHJsLmlkKS50aGVuKGZ1bmN0aW9uKHIpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLm1lZGlhID0gcjsgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbWVkaWEgZWRpdCBhY3RpdmUnLCAkY3RybCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jYW5jZWwgPSBmdW5jdGlvbigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAkY3RybC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnNhdmUoJGN0cmwubWVkaWEpLnRoZW4oZnVuY3Rpb24ocikge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoJGN0cmwubWVkaWEsIHIpO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLm1vZGFsSW5zdGFuY2UuY2xvc2UoJGN0cmwubWVkaWEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnbWVkaWFFZGl0JyxcclxuICAgIHtcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tZWRpYS9tZWRpYS1lZGl0LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICBpZDogJzwnLFxyXG4gICAgICAgICAgICByZXNvbHZlOiAnPCcsXHJcbiAgICAgICAgICAgIGNsb3NlOiAnJicsXHJcbiAgICAgICAgICAgIGRpc21pc3M6ICcmJyxcclxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogJzwnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb250cm9sbGVyOiBbJ01lZGlhU2VydmljZScsIGNvbnRyb2xsZXJdXHJcbiAgICB9KTtcclxufSkoKTtcclxuIiwiLy9tZWRpYS1saXN0LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnbWVkaWEnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCR1aWJNb2RhbCwgc2VydmljZSkge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHBhZ2VTaXplRGVmYXVsdCA9IDEwO1xyXG4gICAgICAgIHZhciB0YWJsZVN0YXRlUmVmO1xyXG5cclxuICAgICAgICAkY3RybC5zZWFyY2hNb2RlbCA9IHtcclxuICAgICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplRGVmYXVsdFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5zZWFyY2ggPSBmdW5jdGlvbiAodGFibGVTdGF0ZSkge1xyXG4gICAgICAgICAgICB0YWJsZVN0YXRlUmVmID0gdGFibGVTdGF0ZTtcclxuXHJcbiAgICAgICAgICAgIHNlcnZpY2UuZ2V0QWxsTWVkaWEoJGN0cmwuc2VhcmNoTW9kZWwpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLm1lZGlhID0gci5yZXN1bHRzO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwgPSByO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlICRjdHJsLnNlYXJjaE1vZGVsLnJlc3VsdHM7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwucGFnZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmVkaXQgPSBmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICRjdHJsLnNlbGVjdGVkTWVkaWEgPSBpdGVtOyBcclxuICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnbWVkaWFFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGl0ZW0uaWRcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbGcnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGNsb3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZXN1bHQgd2FzLT5cIik7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8ocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKCRjdHJsLnNlbGVjdGVkTWVkaWEsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIkkgd2FzIGRpbWlzc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlYXNvbiB3YXMtPlwiICsgcmVhc29uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5zaG93RGV0YWlscyA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdtZWRpYVN1bW1hcnknLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgYXNNb2RhbDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdsZydcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiSSB3YXMgY2xvc2VkLCBzbyBkbyB3aGF0IEkgbmVlZCB0byBkbyBteUNvbnRlbnQncyBjb250cm9sbGVyIG5vdy4gIFJlc3VsdCB3YXMtPlwiKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhyZXN1bHQpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJJIHdhcyBkaW1pc3NlZCwgc28gZG8gd2hhdCBJIG5lZWQgdG8gZG8gbXlDb250ZW50J3MgY29udHJvbGxlciBub3cuICBSZWFzb24gd2FzLT5cIiArIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnbGlzdCcsXHJcbiAgICB7XHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbWVkaWEvbWVkaWEtbGlzdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogWyckdWliTW9kYWwnLCAnTWVkaWFTZXJ2aWNlJywgY29udHJvbGxlcl1cclxuICAgIH0pO1xyXG5cclxufVxyXG4pKCk7IiwiLy9tZWRpYS1zdW1tYXJ5LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdtZWRpYScpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoc2VydmljZSkge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdW1tYXJ5IGFjdGl2ZScpO1xyXG4gICAgICAgICAgICBpZiAoJGN0cmwucmVzb2x2ZSkge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuaWQgPSAkY3RybC5yZXNvbHZlLmlkO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuYXNNb2RhbCA9ICRjdHJsLnJlc29sdmUuYXNNb2RhbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2VydmljZS5nZXRNZWRpYSgkY3RybC5pZCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwubWVkaWEgPSByO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGN0cmwuZGlzbWlzcygpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnbWVkaWFTdW1tYXJ5JyxcclxuICAgIHtcclxuICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICBpZDogJzwnLFxyXG4gICAgICAgICAgICBhc01vZGFsOiAnPCcsXHJcbiAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcclxuICAgICAgICAgICAgY2xvc2U6ICcmJyxcclxuICAgICAgICAgICAgZGlzbWlzczogJyYnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tZWRpYS9tZWRpYS1zdW1tYXJ5LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOiBbJ01lZGlhU2VydmljZScsIGNvbnRyb2xsZXJdXHJcbiAgICB9KTtcclxuXHJcbn1cclxuKSgpOyIsIi8vYXBwLWRpcmVjdGl2ZXMubW9kdWxlcy5qc1xyXG4oZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJywgW10pLmRpcmVjdGl2ZSgnc3RTdWJtaXRTZWFyY2gnLCBbJ3N0Q29uZmlnJywgJyR0aW1lb3V0JywgJyRwYXJzZScsIGZ1bmN0aW9uIChzdENvbmZpZywgJHRpbWVvdXQsICRwYXJzZSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICdec3RUYWJsZScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0ciwgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuYmluZCgnY2xpY2snLFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlQ3RybCA9IGN0cmw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlQ3RybC5waXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcclxuXHJcblxyXG59KSgpOyIsIi8vYXBwLnNlcnZpY2UuanNcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnLCBbXSk7XHJcbiAgICB9XHJcbikoKTsiLCIvL21lZGlhLnNlcnZpY2UuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnKS5mYWN0b3J5KCdNZWRpYVNlcnZpY2UnLCBtZWRpYVNlcnZpY2UpO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1lZGlhU2VydmljZSgkaHR0cCkge1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRNZWRpYTogZ2V0TWVkaWEsXHJcbiAgICAgICAgICAgIGdldEFsbE1lZGlhOiBnZXRBbGxNZWRpYSxcclxuICAgICAgICAgICAgc2F2ZTogc2F2ZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldE1lZGlhKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJ2FwaS9tZWRpYS8nICsgaWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByLmRhdGE7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBbGxNZWRpYShzZWFyY2hNb2RlbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCdhcGkvbWVkaWEnLCB7IHBhcmFtczogc2VhcmNoTW9kZWwgfSkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHIuZGF0YTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNhdmUobWVkaWEpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCgnYXBpL21lZGlhJywgbWVkaWEpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByLmRhdGE7IFxyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG59XHJcbikoKTsiXX0=
